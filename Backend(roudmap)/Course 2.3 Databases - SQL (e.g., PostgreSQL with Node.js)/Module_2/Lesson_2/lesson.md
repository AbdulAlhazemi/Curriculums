## ๐๏ธ ุงููุญุฏุฉ 2: ุงุณุชุนูุงูุงุช SQL ุงููุชูุฏูุฉ ูุชุตููู ููุงุนุฏ ุงูุจูุงูุงุช

### ๐ ุงูุฏุฑุณ 2: ุงูุงุณุชุนูุงูุงุช ุงููุฑุนูุฉ ู CTEs

#### ๐ง **ูุงุฐุง ุณุชุชุนูู**
* ูุง ูู ุงูุงุณุชุนูุงู ุงููุฑุนู (Subquery) ูููููุฉ ุงุณุชุฎุฏุงูู.
* ุงุณุชุฎุฏุงู ุงูุงุณุชุนูุงูุงุช ุงููุฑุนูุฉ ูู ุฌูู `WHERE`, `FROM`, ู `SELECT`.
* ูุง ูู ุชุนุจูุฑ ุงูุฌุฏูู ุงูุดุงุฆุน (Common Table Expression - CTE) ูููู ูุจุณุท ุงูุงุณุชุนูุงูุงุช ุงููุนูุฏุฉ.
* ูุฒุงูุง ุงุณุชุฎุฏุงู CTEs ูุชุญุณูู ูุงุจููุฉ ูุฑุงุกุฉ ุงูููุฏ.

---
### ๐ค 1. ูุง ูู ุงูุงุณุชุนูุงู ุงููุฑุนู (Subquery)ุ
ุงูุงุณุชุนูุงู ุงููุฑุนู (ููุนุฑู ุฃูุถูุง ุจุงูุงุณุชุนูุงู ุงููุชุฏุงุฎู ุฃู ุงูุฏุงุฎูู) ูู ุงุณุชุนูุงู `SELECT` ูุชู ูุชุงุจุชู **ุฏุงุฎู** ุงุณุชุนูุงู SQL ุขุฎุฑ. ูุชู ุชูููุฐ ุงูุงุณุชุนูุงู ุงูุฏุงุฎูู ุฃููุงูุ ูุชูุณุชุฎุฏู ูุชูุฌุชู ุจูุงุณุทุฉ ุงูุงุณุชุนูุงู ุงูุฎุงุฑุฌู.

> **ุจุจุณุงุทุฉ:** ุฅูู ูุซู ุทุฑุญ ุณุคุงู ูุนุชูุฏ ุนูู ุฅุฌุงุจุฉ ุณุคุงู ุขุฎุฑ. ุนูู ุณุจูู ุงููุซุงู: "ูู ูู ุงููุคูููู ุงูุฐูู ูุชุจูุง ุงููุชุจ ุงูุชู ุญุตูุช ุนูู ุชูููู ุฃุนูู ูู 4 ูุฌููุ". ุนููู ุฃููุงู ุฃู ุชุฌุฏ "ุงููุชุจ ุงูุชู ุญุตูุช ุนูู ุชูููู ุฃุนูู ูู 4 ูุฌูู"ุ ุซู ุชุณุชุฎุฏู ูุฐู ุงููุงุฆูุฉ ููุนุซูุฑ ุนูู ูุคููููุง.

---
### โ๏ธ 2. ุงุณุชุฎุฏุงูุงุช ุงูุงุณุชุนูุงูุงุช ุงููุฑุนูุฉ
ุณูุณุชุฎุฏู ููุณ ุฌุฏููู `authors` ู `books` ูู ุงูุฏุฑุณ ุงูุณุงุจู.

#### **ุฃ. ูู ุฌููุฉ `WHERE` (ุงูุฃูุซุฑ ุดููุนูุง)**
ุชูุณุชุฎุฏู ูููุชุฑุฉ ุจูุงูุงุช ุงูุงุณุชุนูุงู ุงูุฎุงุฑุฌู ุจูุงุกู ุนูู ูุชูุฌุฉ ุงูุงุณุชุนูุงู ุงูุฏุงุฎูู.

**ูุซุงู:** ุฌูุจ ุฌููุน ุงููุชุจ ุงูุชู ูุชุจูุง 'George Orwell'.
```sql
SELECT title
FROM books
WHERE author_id = (SELECT id FROM authors WHERE name = 'George Orwell');
```
* **ุงูุฎุทูุฉ 1:** ููููุฐ ุงูุงุณุชุนูุงู ุงูุฏุงุฎูู `(SELECT id FROM authors WHERE name = 'George Orwell')` ุฃููุงู ูููุฑุฌุน ุงููููุฉ `1`.
* **ุงูุฎุทูุฉ 2:** ูุตุจุญ ุงูุงุณุชุนูุงู ุงูุฎุงุฑุฌู `SELECT title FROM books WHERE author_id = 1;`.

**ูุซุงู ูุน `IN`:** ุฌูุจ ุฃุณูุงุก ุฌููุน ุงููุคูููู ุงูุฐูู ูุฏููู ูุชุจ.
```sql
SELECT name
FROM authors
WHERE id IN (SELECT DISTINCT author_id FROM books);
```
---
#### **ุจ. ูู ุฌููุฉ `FROM`**
ููููู ุงุณุชุฎุฏุงู ูุชูุฌุฉ ุงุณุชุนูุงู ูุฑุนู ูุฌุฏูู ูุคูุช ุชุฌุฑู ุนููู ุนูููุงุช ุฃุฎุฑู.

**ูุซุงู:** ุญุณุงุจ ูุชูุณุท ุนุฏุฏ ุงููุชุจ ููู ูุคูู.
```sql
SELECT AVG(book_count) AS average_books_per_author
FROM (
    -- ูุฐุง ุงูุงุณุชุนูุงู ุงููุฑุนู ููุดุฆ ุฌุฏูููุง ูุคูุชูุง
    SELECT author_id, COUNT(*) AS book_count
    FROM books
    GROUP BY author_id
) AS derived_table; -- ูุฌุจ ุฏุงุฆููุง ุฅุนุทุงุก ุงุณู ูุณุชุนุงุฑ (alias) ููุฌุฏูู ุงููุดุชู
```
---
### โจ 3. ุชุนุจูุฑุงุช ุงูุฌุฏุงูู ุงูุดุงุฆุนุฉ (Common Table Expressions - CTEs)
ุงูู CTE ูู ุจุฏูู ุฃูุซุฑ ุชูุธูููุง ููุฑุงุกุฉ ููุงุณุชุนูุงูุงุช ุงููุฑุนูุฉ ุงููุนูุฏุฉ. ูุณูุญ ูู ุจุฅูุดุงุก ูุชูุฌุฉ ูุคูุชุฉ ูุชุณููุชูุงุ ุซู ุงุณุชุฎุฏุงููุง ูู ุงุณุชุนูุงู ูุงุญู.

ูุชู ุชุนุฑูู ุงูู CTE ุจุงุณุชุฎุฏุงู ุฌููุฉ `WITH`.

**ูุซุงู:** ุฅุนุงุฏุฉ ูุชุงุจุฉ ูุซุงู ุญุณุงุจ ุงููุชูุณุท ุจุงุณุชุฎุฏุงู CTE.
```sql
WITH author_book_counts AS (
    -- ูุฐุง ูู ุงูู CTEุ ููู ุจูุซุงุจุฉ ุฌุฏูู ูุคูุช ุงุณูู author_book_counts
    SELECT author_id, COUNT(*) AS book_count
    FROM books
    GROUP BY author_id
)
-- ุงูุขู ููููู ุงุณุชุฎุฏุงู ูุฐุง ุงูุฌุฏูู ุงููุคูุช ูู ุงุณุชุนูุงูู ุงูุฑุฆูุณู
SELECT AVG(book_count) AS average_books_per_author
FROM author_book_counts;
```
ูุงุญุธ ููู ุฃู ุงูููุฏ ุฃุตุจุญ **ุฃูุซุฑ ูุถูุญูุง** ูุณูููุฉ ูู ุงููุฑุงุกุฉุ ุญูุซ ุชู ูุตู ููุทู ุญุณุงุจ ุนุฏุฏ ุงููุชุจ ููู ูุคูู ูู ุฎุทูุฉ ููุทููุฉ ุฎุงุตุฉ ุจู.

---
