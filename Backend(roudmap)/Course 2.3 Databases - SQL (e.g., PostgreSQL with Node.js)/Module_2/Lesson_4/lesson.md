## 🗃️ الوحدة 2: استعلامات SQL المتقدمة وتصميم قواعد البيانات

### 📘 الدرس 4: الفهارس (Indexes) وأهميتها للأداء

#### 🧠 **ماذا ستتعلم**
* ما هو فهرس قاعدة البيانات (Database Index).
* كيف تقوم الفهارس بتسريع استعلامات `SELECT`.
* المقايضة (trade-off) بين سرعة القراءة وسرعة الكتابة عند استخدام الفهارس.
* كيفية إنشاء فهرس في SQL.

---
### 🤔 1. المشكلة: البحث البطيء في الجداول الكبيرة
تخيل أن لديك جدول `users` يحتوي على ملايين السجلات. إذا أردت البحث عن مستخدم معين، ستنفذ استعلامًا مثل:
```sql
SELECT * FROM users WHERE username = 'jameel123';
```
بدون فهرس، ستقوم قاعدة البيانات بعملية تسمى **المسح الكامل للجدول (Full Table Scan)**. هذا يعني أنها ستضطر إلى المرور على **كل صف** في الجدول، واحدًا تلو الآخر، ومقارنة قيمة `username` حتى تجد الصف المطلوب. هذه العملية بطيئة جدًا وغير فعالة في الجداول الكبيرة.

> **ببساطة:** هذا يشبه محاولة العثور على موضوع معين في كتاب ضخم لا يحتوي على فهرس في نهايته. ستضطر إلى تقليب كل صفحة من البداية إلى النهاية.

---
### 💡 2. الحل: الفهرس (The Index)
فهرس قاعدة البيانات هو هيكل بيانات منفصل (عادة ما يكون من نوع B-Tree) يقوم بتخزين قيم عمود معين (أو عدة أعمدة) بترتيب معين، مع مؤشر يشير إلى الموقع الفعلي للصف الكامل على القرص.

> **ببساطة:** الفهرس في قاعدة البيانات يعمل تمامًا مثل **الفهرس الموجود في نهاية الكتاب**. بدلاً من قراءة الكتاب بأكمله، تذهب إلى الفهرس المرتب أبجديًا، تبحث عن الموضوع، والذي يخبرك برقم الصفحة المحدد لتذهب إليه مباشرة. هذا أسرع بكثير.

---
### ⚙️ 3. كيف تعمل الفهارس؟

* **عمليات القراءة (`SELECT`):** عندما تنفذ استعلامًا يحتوي على جملة `WHERE` على عمود مفهرس، تقوم قاعدة البيانات بالبحث السريع في الفهرس الصغير والمنظم أولاً. بمجرد العثور على القيمة، تستخدم المؤشر للقفز مباشرة إلى موقع الصف في الجدول الرئيسي، متجنبة بذلك المسح الكامل للجدول. هذا يجعل عمليات القراءة **أسرع بكثير**.

* **عمليات الكتابة (`INSERT`, `UPDATE`, `DELETE`):** هنا تكمن المقايضة. عندما تضيف صفًا جديدًا أو تعدل قيمة في عمود مفهرس، يجب على قاعدة البيانات ليس فقط تحديث الجدول الرئيسي، بل يجب عليها أيضًا **تحديث الفهرس** للحفاظ على ترتيبه الصحيح. هذا يجعل عمليات الكتابة **أبطأ قليلاً**.

**الخلاصة:** الفهارس هي مقايضة. تحصل على قراءة سريعة جدًا مقابل كتابة أبطأ قليلاً.

---
### ✨ 4. كيفية إنشاء فهرس
يتم إنشاء الفهارس باستخدام الأمر `CREATE INDEX`.
**الصيغة العامة:**
```sql
CREATE INDEX index_name ON table_name (column_name);
```
**مثال:** لتسريع البحث عن المستخدمين بأسمائهم في جدول `users`.
```sql
CREATE INDEX idx_users_username ON users (username);
```
> **ملاحظة:** عندما تقوم بتعريف `PRIMARY KEY` أو `UNIQUE` على عمود، تقوم معظم قواعد البيانات بإنشاء فهرس لهذا العمود تلقائيًا.

---
### 🎯 5. متى نستخدم الفهارس؟
* على الأعمدة التي تستخدم بشكل متكرر في جملة `WHERE`.
* على أعمدة المفاتيح الأجنبية (Foreign Keys) المستخدمة في عمليات `JOIN`.
* على الأعمدة التي تستخدم بشكل متكرر للفرز في جملة `ORDER BY`.

**تحذير:** لا تقم بفهرسة كل عمود! كل فهرس يستهلك مساحة على القرص ويبطئ عمليات الكتابة. قم بفهرسة الأعمدة التي تحتاجها لتحسين أداء الاستعلامات المهمة فقط.

---
