## 🔑 الوحدة 3: مواضيع متقدمة في الأمان

### 📘 الدرس 1: مقدمة في OAuth 2.0 و OpenID Connect

#### 🧠 **ماذا ستتعلم**
* ما هو بروتوكول OAuth 2.0 والمشكلة التي يحلها (التخويل المفوض).
* ما هو بروتوكول OpenID Connect (OIDC) وكيف يضيف طبقة هوية فوق OAuth 2.0.
* الأدوار المختلفة في تدفق OAuth 2.0.
* كيف تعمل ميزة "تسجيل الدخول باستخدام جوجل/فيسبوك" بشكل مفاهيمي.

---
### 🤔 1. المشكلة: كيف تسمح لتطبيق بالوصول إلى بياناتك بأمان؟
تخيل أنك تريد استخدام تطبيق جديد لتحرير الصور (`CoolPhotoApp`)، وتريد منه الوصول إلى صورك المخزنة على Google Photos.

* **الطريقة السيئة والخطيرة:** أن يقوم `CoolPhotoApp` بطلب اسم المستخدم وكلمة المرور الخاصة بحسابك في جوجل. **لا يجب أن تفعل هذا أبدًا!** هذا يعطي التطبيق وصولاً كاملاً إلى كل شيء في حسابك (بريدك الإلكتروني، مستنداتك، إلخ) ويعرض كلمة مرورك للخطر.

* **الحل:** نحن بحاجة إلى طريقة لمنح `CoolPhotoApp` **إذنًا محدودًا ومفوضًا** للوصول إلى **صورك فقط**، دون أن يطلع أبدًا على كلمة المرور الخاصة بك.

---
### 🔐 2. الحل: OAuth 2.0 - بروتوكول التخويل
**OAuth 2.0** هو بروتوكول قياسي **للتخويل المفوض (Delegated Authorization)**. هو يسمح للمستخدم بمنح تطبيق طرف ثالث وصولاً محدودًا إلى موارده الموجودة على خدمة أخرى، دون كشف بيانات اعتماده (كلمة المرور).

> **ببساطة:** OAuth 2.0 يشبه إعطاء **مفتاح خدمة صف السيارات (Valet Key)**. يمكن لهذا المفتاح تشغيل السيارة وتحريكها، لكنه لا يستطيع فتح صندوق الأمتعة أو درج التابلوه. أنت تفوض إذنًا محدودًا لعامل صف السيارات (التطبيق الثالث) دون أن تعطيه مفتاحك الرئيسي (كلمة مرورك).

**الأدوار في OAuth 2.0:**
* **مالك المورد (Resource Owner):** أنت، المستخدم.
* **العميل (Client):** تطبيق الطرف الثالث (`CoolPhotoApp`).
* **خادم التخويل (Authorization Server):** الخدمة التي تتحقق من هويتك وتصدر توكنات الوصول (مثل خادم تسجيل الدخول لجوجل).
* **خادم المورد (Resource Server):** الخادم الذي يستضيف بياناتك (مثل خادم Google Photos API).

---
### 👤 3. وماذا عن تسجيل الدخول؟ - OpenID Connect (OIDC)
**OAuth 2.0 مخصص للتخويل فقط**، أي منح الأذونات. هو يعطي التطبيق `accessToken` للوصول إلى بياناتك، لكنه لا يوفر طريقة قياسية للحصول على معلومات حول **هويتك** (مثل اسمك، بريدك الإلكتروني، صورتك الشخصية).

**OpenID Connect (OIDC)** هو **طبقة هوية (identity layer)** بسيطة مبنية **فوق OAuth 2.0**.
* يستخدم نفس تدفق OAuth 2.0، ولكنه يضيف ميزة أساسية: بالإضافة إلى `accessToken`، فإنه يوفر أيضًا **`id_token`**.
* الـ `id_token` هو عبارة عن JWT يحتوي على معلومات تم التحقق منها حول هوية المستخدم.

**الخلاصة:** عندما ترى زر "تسجيل الدخول باستخدام جوجل"، فأنت في الواقع تستخدم **OpenID Connect** للمصادقة، والذي بدوره يستخدم **OAuth 2.0** للتخويل.

---
### ⚙️ 4. دورة عمل "تسجيل الدخول باستخدام جوجل" (بشكل مبسط)
1.  **الضغط على الزر:** تنقر على "تسجيل الدخول باستخدام جوجل" في `CoolPhotoApp`.
2.  **إعادة التوجيه إلى جوجل:** يقوم التطبيق بتوجيهك إلى صفحة تسجيل الدخول الخاصة بجوجل.
3.  **المصادقة والموافقة:** تقوم بتسجيل الدخول بحساب جوجل الخاص بك (إذا لم تكن مسجلاً بالفعل). تظهر لك شاشة تطلب موافقتك ("`CoolPhotoApp` يود الوصول إلى معلومات ملفك الشخصي وصورك"). تنقر على "سماح".
4.  **جوجل يعيد التوجيه:** يقوم جوجل بإعادتك إلى `CoolPhotoApp` مع "رمز تخويل" مؤقت.
5.  **التطبيق يتبادل الرمز بالتوكنات:** في الخلفية، يأخذ خادم `CoolPhotoApp` هذا الرمز ويرسله إلى خادم جوجل، ويستبدله بـ `accessToken` (للوصول إلى صورك) و `id_token` (الذي يحتوي على معلومات هويتك).
6.  **تسجيل الدخول بنجاح:** يستخدم التطبيق المعلومات من `id_token` لإنشاء حساب لك أو تسجيل دخولك إلى حسابك الحالي لديه.

---
