## 🟩 الوحدة 4: التعامل مع الأخطاء وتصحيحها (Error Handling & Debugging)

### 📘 الدرس 2: تصحيح تطبيقات Node.js (Debugging)

#### 🧠 **ماذا ستتعلم؟**
* أهمية التصحيح (debugging) أثناء تطوير تطبيقات Node.js.
* كيفية استخدام `console.log()` بفعالية.
* استخدام أداة التصحيح المدمجة في Node.js (`node inspect`).
* كيفية التصحيح باستخدام Visual Studio Code.
* أفضل الممارسات في تتبع الأخطاء المعقدة.

***

### 1. لماذا نحتاج التصحيح؟
حتى أفضل المبرمجين يرتكبون أخطاء! التصحيح هو عملية تتبع الكود لفهم سلوكه واكتشاف الأسباب وراء الأخطاء أو السلوك غير المتوقع.

***

### 2. التصحيح باستخدام `console.log`
📌 أبسط شكل للتصحيح هو طباعة قيم المتغيرات أثناء تنفيذ الكود.

```javascript
function divide(a, b) {
  console.log("قيمة a:", a, "قيمة b:", b);
  if (b === 0) {
    console.error("خطأ: لا يمكن القسمة على صفر!");
    return Infinity;
  }
  return a / b;
}

console.log(divide(10, 0)); // تحقق من النتيجة والمخرجات في الطرفية
```
> **العيب:** هذه الطريقة غير فعالة للكود الكبير أو المنطق المعقد، وتتطلب إضافة وإزالة الكثير من الأكواد.

***

### 3. استخدام Node.js Debugger (`node inspect`)
يمكنك تشغيل المصحح المدمج في Node.js مباشرة من الطرفية.
```bash
node inspect app.js
```
أمثلة للأوامر داخل واجهة التصحيح:
* `cont` أو `c` – الاستمرار في التنفيذ حتى نقطة التوقف التالية أو نهاية البرنامج.
* `next` أو `n` – تنفيذ السطر التالي.
* `watch('x')` – مراقبة قيمة المتغير `x`.
* `repl` – للدخول إلى وضع يمكنك فيه تنفيذ تعبيرات جافاسكريبت في السياق الحالي.

📌 يمكنك إضافة نقطة توقف (breakpoint) مباشرة في الكود الخاص بك باستخدام:
```javascript
debugger;
```

***

### 4. التصحيح باستخدام VS Code
هذه هي الطريقة الأكثر شيوعًا وفعالية.

**الخطوات:**
1.  افتح مجلد المشروع في Visual Studio Code.
2.  افتح الملف الذي يحتوي على الكود المراد تصحيحه.
3.  ضع نقاط توقف (Breakpoints) عبر النقر بالماوس بجانب أرقام الأسطر.
4.  اذهب إلى قائمة "Run and Debug" (أو اضغط على `F5`).
5.  اختر بيئة "Node.js" لبدء جلسة التصحيح.
6.  راقب المتغيرات، المكدس (Call Stack)، وسير التنفيذ في لوحة التصحيح.

***

### 5. نصائح وأفضل ممارسات
✅ لا تترك `console.log()` التشخيصية في الكود النهائي.
✅ استخدم نقاط التوقف بدلًا من الإكثار من الطباعة لفهم تدفق البرنامج.
✅ راقب أداء الوظائف التي تتعامل مع الملفات أو الشبكة، فقد تكون مصدرًا للأخطاء غير المتوقعة.
✅ استخدم `try/catch` لتضييق نطاق الأخطاء وتسهيل تحديد مصدرها.
✅ احرص على وجود اختبارات آلية (Tests) لتسهيل العثور على المشكلات مبكرًا.

***