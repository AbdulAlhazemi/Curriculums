## 📬 الوحدة 1: أساسيات طوابير الرسائل

### 📘 الدرس 6: أنماط الرسائل الشائعة

#### 🧠 **ماذا ستتعلم**

  * نمط "طوابير العمل" (Work Queues) لتوزيع المهام.
  * نمط "النشر/الاشتراك" (Publish/Subscribe) لبث الرسائل.
  * دور أنواع التبادلات المختلفة (`Direct`, `Fanout`) في تحقيق هذه الأنماط.

-----

### 🤔 1. ما وراء الطابور البسيط

في الدرس السابق، رأينا دورة عمل بسيطة حيث يرسل منتج رسالة إلى طابور واحد يستهلكه مستهلك واحد. لكن القوة الحقيقية لـ RabbitMQ تكمن في قدرته على تنفيذ أنماط توجيه أكثر تعقيدًا لتناسب حالات استخدام مختلفة.

-----

### 🧑‍🤝‍🧑 2. نمط طوابير العمل (Work Queues)

**الهدف:** توزيع المهام التي تستغرق وقتًا طويلاً على عدة "عمال" (مستهلكين) بالتساوي.

  * **كيف يعمل:**
    1.  يقوم المنتج بإرسال العديد من الرسائل (المهام) إلى **طابور واحد مشترك**.
    2.  يتم تشغيل عدة نسخ من المستهلك، وجميعها تستمع إلى **نفس الطابور**.
    3.  يقوم RabbitMQ بتسليم كل رسالة إلى **مستهلك واحد فقط** من المستهلكين المتاحين (بشكل افتراضي، يستخدم خوارزمية Round-robin للتوزيع).

> **ببساطة:** تخيل **موقف سيارات أجرة** (الطابور). هناك العديد من سيارات الأجرة (المستهلكون) تنتظر في الطابور. عندما يصل راكب جديد (رسالة)، تقوم **سيارة أجرة واحدة فقط** بأخذه. هذا يوزع عبء العمل على جميع السائقين.

  * **حالة الاستخدام:** معالجة الفيديوهات، إنشاء التقارير، أي مهمة ثقيلة يمكن تقسيمها وتشغيلها على التوازي.

-----

### 📢 3. نمط النشر/الاشتراك (Publish/Subscribe)

**الهدف:** إرسال رسالة واحدة إلى **عدة مستهلكين** في نفس الوقت.

  * **كيف يعمل:** هذا النمط يعتمد بشكل أساسي على **التبادل (Exchange)**.

    1.  يقوم المنتج بنشر رسالة إلى **تبادل**، دون أن يعرف أي شيء عن الطوابير أو المستهلكين.
    2.  يتم ربط عدة طوابير بهذا التبادل.
    3.  يقوم التبادل بإرسال **نسخة** من الرسالة إلى **كل طابور** مرتبط به.
    4.  كل مستهلك يستمع إلى طابوره الخاص ويستقبل نسخة من الرسالة.

  * **تبادل `fanout`:**
    هو أبسط نوع من التبادلات لتحقيق هذا النمط. التبادل من نوع `fanout` يقوم ببساطة **ببث (broadcast)** جميع الرسائل التي يستقبلها إلى جميع الطوابير التي يعرفها (المرتبطة به)، متجاهلاً أي مفاتيح توجيه.

> **ببساطة:** تخيل **محطة راديو** (التبادل). المحطة تبث برنامجًا (الرسالة). يمكن للعديد من الأشخاص في منازلهم (المستهلكون) ضبط أجهزة الراديو الخاصة بهم (الطوابير الخاصة بهم) والاستماع إلى **نفس البث** في نفس الوقت.

  * **حالة الاستخدام:** إرسال إشعارات فورية لجميع المستخدمين المتصلين، تحديثات أسعار حية، نظام تسجيل أحداث (logging) حيث تحتاج عدة خدمات إلى نسخة من كل حدث.

-----

