## ๐ ุงููุดุฑูุน ุงูููุงุฆู: ูุธุงู ูุนุงูุฌุฉ ุตูุฑ ุบูุฑ ูุชุฒุงูู

### ๐ฏ ุงููุฏู
ุจูุงุก ูุธุงู ูุชูุงูู ูุชููู ูู ุฎุฏูุชูู ูููุตูุชูู: ูุงุฌูุฉ API ูุงุณุชูุจุงู ุฑูุน ุงูุตูุฑุ ู"ุนุงูู" (Worker) ูู ุงูุฎูููุฉ ููุนุงูุฌุฉ ูุฐู ุงูุตูุฑ. ุณุชุชูุงุตู ุงูุฎุฏูุชุงู ุจุดูู ุบูุฑ ูุชุฒุงูู ุจุงุณุชุฎุฏุงู RabbitMQุ ููุง ูุทุจู ุงููุจุงุฏุฆ ุงูุฃุณุงุณูุฉ ููุตู ุงูุฎุฏูุงุช (decoupling) ูุชุญุณูู ุงุณุชุฌุงุจุฉ ุงูุชุทุจูู.

---

### ๐ ูุตู ุงููุดุฑูุน
ุณุชููู ุจุจูุงุก ุชุทุจูููู Node.js:
1.  **ุฎุงุฏู API (`api-server`):** ุชุทุจูู Express ุจุณูุท ูุญุชูู ุนูู ููุทุฉ ููุงูุฉ ูุงุญุฏุฉ (`POST /upload`) ูุงุณุชูุจุงู ูููุงุช ุงูุตูุฑ ูู ุงููุณุชุฎุฏู.
2.  **ุนุงูู ูุนุงูุฌุฉ (`image-worker`):** ุณูุฑุจุช Node.js ูุนูู ุจุดูู ูุณุชูุฑ ูู ุงูุฎูููุฉุ ูุณุชูุน ุฅูู ุทุงุจูุฑ ุงูุฑุณุงุฆูุ ููููู ุจูุนุงูุฌุฉ ุงูุตูุฑ ููุฑ ูุตูู ูููุฉ ุฌุฏูุฏุฉ.

---

### ๐ ูููู ุงููุดุฑูุน ุงูููุชุฑุญ
ููุตู ุจุฅูุดุงุก ูุฌูุฏ ุฑุฆูุณู ูููุดุฑูุนุ ูุจุฏุงุฎูู ูุฌูุฏูู ูููุตููู ููู ุฎุฏูุฉ:
```
/async-image-processor
|-- /api-server
|   |-- /uploads          (ุณูุชู ุญูุธ ุงูุตูุฑ ุงูุฃุตููุฉ ููุง)
|   |-- index.js
|   |-- package.json
|-- /image-worker
|   |-- /processed        (ุณูุชู ุญูุธ ุงูุตูุฑ ุงููุนุงูุฌุฉ ููุง)
|   |-- worker.js
|   |-- package.json
```

---
### โ๏ธ ููุงู ุงููุดุฑูุน

#### **ุงูุฌุฒุก ุงูุฃูู: ุฎุงุฏู ุงูู API (ุงูููุชุฌ - The Producer)**
ูู ูุฌูุฏ `api-server`ุ ูู ุจุจูุงุก ุชุทุจูู Express ูููู ุจุงูุขุชู:
1.  **ุงูุฅุนุฏุงุฏ:** ุงุณุชุฎุฏู ููุชุจุฉ `multer` ููุชุนุงูู ูุน ุฑูุน ุงููููุงุช.
2.  **ููุทุฉ ุงูููุงูุฉ:** ุฃูุดุฆ ูุณุงุฑูุง `POST /upload`.
3.  **ุงูููุทู:**
    * ุนูุฏ ุงุณุชูุจุงู ุทูุจ ุฑูุน ุตูุฑุฉุ ูู ุจุญูุธ ุงูุตูุฑุฉ ุงูุฃุตููุฉ ูู ูุฌูุฏ `uploads`.
    * ุจุนุฏ ุงูุญูุธ ูุจุงุดุฑุฉุ ูู ุจุฅูุดุงุก **ุฑุณุงูุฉ** ุชุญุชูู ุนูู ูุนูููุงุช ุญูู ุงููููุฉ (ูุซู ูุณุงุฑ ุงูุตูุฑุฉ ุงูุฃุตููุฉ).
    * ุงุณุชุฎุฏู `amqplib` **ููุดุฑ (publish)** ูุฐู ุงูุฑุณุงูุฉ ุฅูู ุชุจุงุฏู (exchange) ูู RabbitMQ ูุน ููุชุงุญ ุชูุฌูู (routing key) ููุงุณุจ (ูุซู `image.process`).
    * ุฃุฑุณู **ููุฑูุง** ุงุณุชุฌุงุจุฉ `202 Accepted` ูููุณุชุฎุฏู ูุน ุฑุณุงูุฉ ูุซู "ุชู ุงุณุชูุงู ุตูุฑุชู ูุฌุงุฑู ูุนุงูุฌุชูุง."

#### **ุงูุฌุฒุก ุงูุซุงูู: ุงูุนุงูู (ุงููุณุชููู - The Consumer)**
ูู ูุฌูุฏ `image-worker`ุ ูู ุจุจูุงุก ุณูุฑุจุช `worker.js` ูููู ุจุงูุขุชู:
1.  **ุงูุฅุนุฏุงุฏ:** ุงุณุชุฎุฏู ููุชุจุฉ `sharp` ููุนุงูุฌุฉ ุงูุตูุฑ ูููุชุจุฉ `amqplib` ููุงุชุตุงู ุจู RabbitMQ.
2.  **ุงูููุทู:**
    * ุนูุฏ ุจุฏุก ุงูุชุดุบููุ ูุชุตู ุจู RabbitMQ ูููุดุฆ ุทุงุจูุฑูุง (queue) ููุฑุจุทู ุจุงูุชุจุงุฏู ูููุชุงุญ ุงูุชูุฌูู ููุณู ุงูุฐู ูุณุชุฎุฏูู ุงูููุชุฌ (`image.process`).
    * ูุจุฏุฃ ูู **ุงุณุชููุงู (consume)** ุงูุฑุณุงุฆู ูู ุงูุทุงุจูุฑ.
    * ููู ุฑุณุงูุฉุ ูููู ุจุงูุขุชู:
        ุฃ. ููุฑุฃ ูุณุงุฑ ุงูุตูุฑุฉ ูู ุญูููุฉ ุงูุฑุณุงูุฉ.
        ุจ. ูุณุชุฎุฏู `sharp` ูุฅูุดุงุก ูุณุฎุฉ ูุตุบุฑุฉ (thumbnail) ูู ุงูุตูุฑุฉ ูุญูุธูุง ูู ูุฌูุฏ `processed`.
        ุฌ. **ุงูุฃูู:** ุจุนุฏ ุงููุฌุงุญ ูู ูุนุงูุฌุฉ ุงูุตูุฑุฉุ ูุฑุณู ุฅูุฑุงุฑูุง **`ack`** ุฅูู RabbitMQ ูุญุฐู ุงูุฑุณุงูุฉ ูู ุงูุทุงุจูุฑ.
        ุฏ. ูู ุญุงูุฉ ุญุฏูุซ ุฎุทุฃุ ูุฌุจ ุฃู ูุฑุณู **`nack`** ุญุชู ูููู ุฅุนุงุฏุฉ ูุญุงููุฉ ุงููููุฉ ุฃู ููููุง ุฅูู ุทุงุจูุฑ ุงูุฑุณุงุฆู ุงูููุชุฉ.

#### **ุงูุฌุฒุก ุงูุซุงูุซ (ุชุญุฏู ุฅุถุงูู): ูุธุงู ุฅุดุนุงุฑุงุช**
1.  ุจุนุฏ ุฃู ูููู ุงูุนุงูู ุจูุนุงูุฌุฉ ุงูุตูุฑุฉ ุจูุฌุงุญ ูู ุงูุฌุฒุก ุงูุซุงููุ ุงุฌุนูู ููุดุฑ ุฑุณุงูุฉ ุฌุฏูุฏุฉ ุฅูู ุชุจุงุฏู ุขุฎุฑ ูู ููุน `fanout` ุงุณูู `events`.
2.  ุฃูุดุฆ ูุณุชููููุง ุซุงูุซูุง (`notification-worker.js`) ูุณุชูุน ุฅูู ูุฐุง ุงูุชุจุงุฏู `events`.
3.  ุนูุฏูุง ูุณุชูุจู ูุฐุง ุงููุณุชููู ุงูุฌุฏูุฏ ุฑุณุงูุฉุ ูููู ููุท ุจุทุจุงุนุฉ ุฑุณุงูุฉ ูู ุงูุทุฑููุฉ ูุซู: `[Notification] Image processed successfully: path/to/image.jpg`. ูุฐุง ูุญุงูู ุฅุฑุณุงู ุฅุดุนุงุฑ ูููุณุชุฎุฏู.

---
### โ ูุนุงููุฑ ุงูุชูููู
* ุงููุตู ุงููุงุถุญ ุจูู ูุณุคูููุงุช ุฎุงุฏู ุงูู API ูุงูุนุงูู.
* ุงุณุชุฌุงุจุฉ ุณุฑูุนุฉ ูู ุงูู API ูููุณุชุฎุฏูุ ุจุบุถ ุงููุธุฑ ุนู ููุช ูุนุงูุฌุฉ ุงูุตูุฑุฉ.
* ุนุงูู ุฎูููุฉ ูุนูู ุจุดูู ููุซูู ููููู ุจูุนุงูุฌุฉ ุงูููุงู ูู ุงูุทุงุจูุฑ.
* ุงูุงุณุชุฎุฏุงู ุงูุตุญูุญ ูุขููุฉ ุงูุฅูุฑุงุฑ (`ack`/`nack`) ูุถูุงู ุนุฏู ููุฏุงู ุฃู ูููุฉ.
* (ุงุฎุชูุงุฑู) ุชุทุจูู ุตุญูุญ ูููุท ุงููุดุฑ/ุงูุงุดุชุฑุงู ููุฅุดุนุงุฑุงุช.

---
### ๐ ุงูุฎุทูุฉ ุงูุฃููู
1.  ุงุจุฏุฃ ุจุฅุนุฏุงุฏ ูููู ุงููุดุฑูุน ุจุงููุฌูุฏูู ุงููููุตููู.
2.  ุฑูุฒ ุฃููุงู ุนูู `api-server`. ูู ุจุจูุงุก ููุทุฉ ุงูููุงูุฉ `POST /upload` ุงูุชู ูููููุง ุงุณุชูุจุงู ููู ูุญูุธู ูุญูููุง. ุชุฃูุฏ ูู ุฃู ูุฐุง ุงูุฌุฒุก ูุนูู ุจุดูู ุตุญูุญ ูุจู ุฅุถุงูุฉ ููุทู RabbitMQ.

ุฃุชููู ูู ูู ุงูุชูููู ูู ูุดุฑูุนู ุงูููุงุฆู!