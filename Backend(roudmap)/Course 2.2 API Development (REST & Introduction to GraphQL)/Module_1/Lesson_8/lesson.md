## 🌐 الوحدة 1: مبادئ وتصميم واجهات RESTful API

### 📘 الدرس 8: أفضل الممارسات في تصميم واجهات API

#### 🧠 **ماذا ستتعلم**
* أفضل الممارسات الأمنية الأساسية لواجهات API.
* مفهوم تحديد معدل الطلبات (Rate Limiting) وأهميته.
* فهم أعمق لمبدأ HATEOAS.
* أهمية وجود استجابات خطأ متسقة وموحدة.

---
### 🛡️ 1. أفضل ممارسات الأمان (Security Best Practices)
أمان الـ API ليس رفاهية، بل هو ضرورة. إليك بعض القواعد الأساسية:

1.  **استخدم HTTPS دائمًا:** يجب أن تكون جميع الاتصالات بين العميل والخادم مشفرة باستخدام SSL/TLS لمنع التجسس على البيانات.
2.  **التحقق من صحة المدخلات (Input Validation):** لا تثق أبدًا بالبيانات القادمة من العميل. قم دائمًا بالتحقق من صحة البيانات في `req.body`, `req.params`, و `req.query` قبل استخدامها. هذا يحميك من هجمات مثل حقن SQL (SQL Injection).
3.  **لا تكشف عن معرفات قاعدة البيانات (Database IDs):** تجنب استخدام المعرفات الرقمية المتزايدة (مثل 1, 2, 3) في عناوين URL (مثل `/users/1`). هذا يسهل على المهاجمين تخمين عناوين URL لموارد أخرى. بدلاً من ذلك، استخدم معرفات فريدة عالميًا (UUIDs) أو أي معرف آخر غير قابل للتنبؤ.
4.  **تطبيق المصادقة والتخويل بشكل صحيح:** تأكد من أن كل نقطة نهاية محمية تتحقق من هوية المستخدم (Authentication) وصلاحياته (Authorization) بشكل صحيح.

---
### ⏱️ 2. تحديد معدل الطلبات (Rate Limiting)
تحديد معدل الطلبات هو تقنية للتحكم في **عدد الطلبات** التي يمكن للعميل إرسالها إلى الـ API الخاص بك في فترة زمنية معينة (على سبيل المثال، 100 طلب في الدقيقة).

* **لماذا هو مهم؟**
    * **منع إساءة الاستخدام:** يمنع المهاجمين من إغراق خادمك بطلبات لا حصر لها (هجمات الحرمان من الخدمة - DoS).
    * **ضمان الاستخدام العادل:** يضمن عدم استئثار مستخدم واحد بجميع موارد الخادم، مما يوفر خدمة مستقرة للجميع.

* **كيف يعمل:** يقوم الخادم بتتبع عدد الطلبات من عنوان IP معين أو مفتاح API. إذا تجاوز العميل الحد المسموح به، يرد الخادم برمز حالة `429 Too Many Requests`. عادة ما يتم تنفيذ ذلك باستخدام Middleware (مثل حزمة `express-rate-limit`).

---
### 🔗 3. نظرة أعمق على HATEOAS
HATEOAS هو اختصار لـ **H**ypermedia **a**s **t**he **E**ngine **o**f **A**pplication **S**tate. وهو مبدأ أساسي في REST، لكنه غالبًا ما يتم تجاهله.

* **الفكرة:** يجب أن تحتوي استجابة الـ API على **روابط** تخبر العميل بالخطوات التالية الممكنة. هذا يجعل الـ API قابلاً للاكتشاف، حيث لا يحتاج العميل إلى كتابة جميع عناوين URL بشكل ثابت في كوده، بل يمكنه اكتشافها من استجابات الخادم.

**مثال:** عند طلب تفاصيل حساب بنكي، قد تبدو الاستجابة كالتالي:
```json
{
  "accountNumber": "ACC123",
  "balance": 500,
  "links": [
    { "rel": "self", "href": "/api/accounts/ACC123" },
    { "rel": "deposit", "href": "/api/accounts/ACC123/deposit" },
    { "rel": "withdraw", "href": "/api/accounts/ACC123/withdraw" }
  ]
}
```
العميل الآن يعرف أنه يمكنه إجراء إيداع عن طريق إرسال طلب `POST` إلى `/api/accounts/ACC123/deposit`.

---
### 🚨 4. التعامل المتسق مع الأخطاء
عندما يحدث خطأ، يجب أن تكون استجابتك متوقعة ومتسقة. هذا يسهل على المطورين الذين يستخدمون الـ API الخاص بك التعامل مع الأخطاء في تطبيقاتهم.

* **الممارسة الأفضل:** استخدم دائمًا صيغة JSON موحدة للأخطاء، بدلاً من إرسال نصوص عادية أو صفحات HTML.
**مثال جيد لاستجابة خطأ `404`:**
```json
{
  "status": "error",
  "statusCode": 404,
  "message": "The requested resource was not found."
}
```

---