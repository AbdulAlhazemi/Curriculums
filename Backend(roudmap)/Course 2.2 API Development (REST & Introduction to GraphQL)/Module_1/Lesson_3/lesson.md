## 🌐 الوحدة 1: مبادئ وتصميم واجهات RESTful API

### 📘 الدرس 3: أفعال HTTP في سياق REST

#### 🧠 **ماذا ستتعلم**
* فهم أعمق للغرض من كل فعل من أفعال HTTP الرئيسية.
* مفهوم **الأمان (Safety)** في أفعال HTTP.
* مفهوم **التكرارية الآمنة (Idempotency)** وأهميتها.
* الفرق الدقيق بين `PUT` و `PATCH`.

---
### 📝 1. مراجعة سريعة لأفعال HTTP
كما تعلمنا، تمثل أفعال HTTP الإجراءات التي نريد تنفيذها على الموارد. في سياق CRUD، يتم تعيينها عادةً كالتالي:
* **C**reate (إنشاء) → `POST`
* **R**ead (قراءة) → `GET`
* **U**pdate (تحديث) → `PUT` أو `PATCH`
* **D**elete (حذف) → `DELETE`

لكن هناك خصائص مهمة لهذه الأفعال تسمى "الأمان" و "التكرارية الآمنة".

---
### 🛡️ 2. مفهوم الأمان (Safety)
يعتبر فعل HTTP **آمنًا (Safe)** إذا كان استدعاؤه **لا يغير حالة الخادم**. بمعنى آخر، هي عمليات قراءة فقط.

* **الأفعال الآمنة:** `GET`, `HEAD`, `OPTIONS`.
* **الأفعال غير الآمنة:** `POST`, `PUT`, `PATCH`, `DELETE` (لأنها جميعًا تعدل البيانات على الخادم).

**لماذا هو مهم؟** يمنح هذا المبدأ ضمانًا للعملاء (مثل المتصفحات أو عناكب محركات البحث) بأنهم يستطيعون طلب مورد باستخدام `GET` بأمان دون القلق بشأن تغيير أو حذف أي شيء عن طريق الخطأ.

---
### 🔄 3. مفهوم التكرارية الآمنة (Idempotency)
يعتبر فعل HTTP **متكررًا آمنًا (Idempotent)** إذا كان إرسال نفس الطلب عدة مرات متتالية له **نفس التأثير** على الخادم كإرساله مرة واحدة فقط.

> **ببساطة:** تخيل زر استدعاء المصعد. الضغط عليه مرة واحدة يستدعي المصعد. الضغط عليه 10 مرات أخرى لن يغير شيئًا؛ النتيجة النهائية هي نفسها (المصعد قادم). هذا السلوك هو "idempotent".

* **الأفعال المتكررة الآمنة (Idempotent):** `GET`, `PUT`, `DELETE`.
* **الأفعال غير المتكررة الآمنة (Non-idempotent):** `POST`, `PATCH` (غالبًا).

**لماذا؟**
* **`POST` ليس Idempotent:** إرسال `POST /users` مرتين سيؤدي إلى إنشاء **مستخدمين جديدين**. حالة الخادم تتغير بعد كل طلب.
* **`PUT` هو Idempotent:** إرسال `PUT /users/123` مع نفس البيانات مرتين سيؤدي إلى نفس النتيجة النهائية: المستخدم 123 لديه هذه البيانات.
* **`DELETE` هو Idempotent:** إرسال `DELETE /users/123` مرتين له نفس التأثير. المرة الأولى تحذف المستخدم، والمرات اللاحقة لن تغير شيئًا (قد تُرجع خطأ 404، لكن حالة الخادم - المستخدم محذوف - تبقى كما هي).

---
### ⚖️ 4. الفرق بين `PUT` و `PATCH`
كلاهما يستخدم للتحديث، لكن بطرق مختلفة.
* **`PUT`:** يستخدم **لاستبدال المورد بالكامل**. يجب عليك إرسال التمثيل الكامل للمورد في جسم الطلب. إذا حذفت حقلاً، فقد يتم تعيينه إلى `null` أو قيمته الافتراضية في قاعدة البيانات. (هذا الفعل Idempotent).
* **`PATCH`:** يستخدم لإجراء **تحديث جزئي**. ترسل فقط الحقول التي تريد تغييرها، وتبقى الحقول الأخرى كما هي. (هذا الفعل ليس Idempotent بشكل عام).

> **ببساطة:** `PUT` يشبه استبدال صورة ملفك الشخصي بالكامل. `PATCH` يشبه فقط تحديث اسمك في ملفك الشخصي مع ترك الصورة وباقي البيانات كما هي.

---
### 📊 5. جدول ملخص الخصائص

| الفعل | الإجراء الأساسي | آمن (Safe)؟ | متكرر آمن (Idempotent)؟ |
| :--- | :--- | :--- | :--- |
| **GET** | قراءة | نعم | نعم |
| **POST** | إنشاء | لا | لا |
| **PUT** | استبدال/تحديث كامل| لا | نعم |
| **DELETE** | حذف | لا | نعم |
| **PATCH** | تحديث جزئي | لا | لا |

---
