## 🐳 الوحدة 1: أساسيات Docker والحاويات

### 📘 الدرس 7: ربط المنافذ والوحدات التخزينية (Volumes)

#### 🧠 **ماذا ستتعلم**
* فهم أعمق لربط المنافذ (Port Mapping).
* لماذا تكون البيانات داخل الحاوية "مؤقتة" (ephemeral).
* ما هي الوحدات التخزينية (Volumes) في Docker ولماذا نستخدمها.
* كيفية استخدام **نقاط الربط (Bind Mounts)** للتطوير المباشر والحفاظ على البيانات.

---
### 🔌 1. إعادة النظر في ربط المنافذ
كما تعلمنا، كل حاوية تعمل في شبكتها الخاصة المعزولة. بشكل افتراضي، لا يمكنك الوصول إلى أي منفذ داخل الحاوية من جهازك المضيف. الخيار `-p` أو `--publish` في أمر `docker run` هو الذي ينشئ **جسرًا** أو "بوابة" بين جهازك والحاوية.

**`p host_port:container_port-`**
هو يربط منفذًا على جهازك المضيف (host) بمنفذ داخل الحاوية (container)، مما يسمح لحركة المرور بالتدفق بينهما. بدون هذا الربط، سيعمل تطبيقك داخل الحاوية، لكنك لن تتمكن من الوصول إليه من الخارج.

---
### 🤔 2. المشكلة: الحاويات المؤقتة
نظام ملفات الحاوية مؤقت. هذا يعني أنه عند إزالة حاوية (`docker rm`)، فإن **جميع البيانات التي تم إنشاؤها داخل نظام ملفات هذه الحاوية يتم حذفها نهائيًا**. هذا يشمل:
* الملفات التي قام المستخدمون برفعها.
* ملفات السجل (log files).
* بيانات قاعدة البيانات.

نحن بحاجة إلى طريقة لتخزين هذه البيانات الهامة في مكان آمن **خارج** دورة حياة الحاوية.

---
### 💾 3. الحل: الوحدات التخزينية (Volumes)
**الوحدات التخزينية** هي الآلية المفضلة في Docker للحفاظ على البيانات التي تنتجها وتستخدمها الحاويات. هي في الأساس مجلدات على جهازك المضيف يتم "تركيبها" داخل نظام ملفات الحاوية.

**نقاط الربط (Bind Mounts):**
النوع الأكثر شيوعًا من الوحدات التخزينية المستخدمة في التطوير هو "نقطة الربط". هي تقوم بربط مباشر بين ملف أو مجلد على جهازك المضيف وملف أو مجلد داخل الحاوية. أي تغيير يحدث في أحد المكانين ينعكس فورًا في الآخر.

* **الصيغة:** نستخدم الخيار `-v` أو `--volume`.
  `v /path/on/your/host:/path/inside/container-`

---
### 💡 4. حالات استخدام الوحدات التخزينية

#### **أ. التطوير المباشر (Live Code Reloading)**
* **المشكلة:** في كل مرة تعدل فيها سطرًا واحدًا في كود تطبيقك، هل يجب عليك إعادة بناء الصورة بأكملها (`docker build`)؟ هذا بطيء جدًا وغير عملي.
* **الحل:**
  1.  نقوم بربط مجلد الكود المصدري على جهازنا المضيف بمجلد العمل داخل الحاوية.
  2.  نشغل أداة مثل `nodemon` داخل الحاوية، والتي تراقب التغييرات وتعيد تشغيل الخادم تلقائيًا.

**مثال:**
```bash
# -v .: /app يربط المجلد الحالي (.) على المضيف بمجلد /app داخل الحاوية
docker run -d -p 3000:3000 -v .:/app --name dev-app my-node-app:v1.0
```
الآن، عندما تقوم بتعديل أي ملف على جهازك المحلي، يرى `nodemon` (الذي يعمل داخل الحاوية) التغيير ويعيد تشغيل خادم Node.js فورًا. يمكنك رؤية التغييرات في متصفحك بمجرد التحديث!

#### **ب. الحفاظ على بيانات قاعدة البيانات**
* **المشكلة:** إذا قمت بتشغيل قاعدة بيانات PostgreSQL في حاوية وأضفت إليها بيانات، ثم قمت بحذف الحاوية، فستفقد جميع بياناتك.
* **الحل:** ربط مجلد بيانات PostgreSQL داخل الحاوية بمجلد على جهازك المضيف.

**مثال:**
```bash
# -v ./db-data:/var/lib/postgresql/data يربط مجلد db-data المحلي
# بمجلد البيانات الافتراضي لـ PostgreSQL داخل الحاوية
docker run -d --name my-postgres -v ./db-data:/var/lib/postgresql/data postgres
```
الآن، جميع بيانات قاعدة البيانات الخاصة بك آمنة على جهازك المضيف، حتى لو قمت بحذف حاوية PostgreSQL وإعادة إنشائها.

---
