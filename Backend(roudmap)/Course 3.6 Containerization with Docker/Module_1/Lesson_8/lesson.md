## 🐳 الوحدة 1: أساسيات Docker والحاويات

### 📘 الدرس 8: مقدمة في Docker Compose

#### 🧠 **ماذا ستتعلم**
* ما هو Docker Compose والمشكلة التي يحلها.
* هيكل ملف `docker-compose.yml`.
* كيفية تعريف خدمات متعددة (مثل تطبيق وقاعدة بيانات) في ملف واحد.
* أوامر `docker-compose` الأساسية (`up` و `down`).

---
### 🤔 1. المشكلة: إدارة عدة حاويات
تطبيقات الويب الحقيقية نادرًا ما تتكون من حاوية واحدة. عادةً ما يكون لديك على الأقل:
* حاوية لتطبيق الويب (Node.js).
* حاوية لقاعدة البيانات (PostgreSQL).
* قد يكون لديك حاوية لـ Redis (للتخزين المؤقت)، وحاويات أخرى.

إدارة كل هذه الحاويات يدويًا باستخدام أوامر `docker run` الطويلة أمر معقد وصعب:
1.  تحتاج إلى إنشاء شبكة Docker يدوية لتمكين الحاويات من التحدث مع بعضها البعض.
2.  تحتاج إلى تشغيل كل حاوية بالأمر الصحيح والخيارات الصحيحة (ربط المنافذ، الوحدات التخزينية، متغيرات البيئة).
3.  تحتاج إلى تذكر ترتيب تشغيلها وإيقافها.

هذا أمر مرهق جدًا ومعرض للخطأ.

---
### 💡 2. الحل: Docker Compose
**Docker Compose** هي أداة لتحديد وتشغيل **تطبيقات Docker متعددة الحاويات**. أنت تستخدم ملفًا بصيغة **YAML** لوصف جميع خدمات تطبيقك، شبكاته، ووحداته التخزينية. ثم، بأمر واحد بسيط، يمكنك إنشاء وبدء جميع هذه الخدمات معًا.

> **ببساطة:** إذا كان تشغيل حاوية واحدة يدويًا يشبه طهي طبق واحد، فإن استخدام Docker Compose يشبه وجود **وصفة رئيسية لوجبة كاملة متعددة الأطباق**. الوصفة تخبرك بالضبط ما هي الأطباق، مكوناتها، وكيفية طهيها معًا في نفس الوقت.

---
### 📝 3. ملف `docker-compose.yml`
هذا هو الملف الذي يصف تطبيقك متعدد الحاويات بالكامل. لنرَ مثالاً لتشغيل تطبيق Express مع قاعدة بيانات PostgreSQL.

```yaml
# تحديد إصدار صيغة Compose (اختياري في الإصدارات الحديثة)
version: '3.8'

# تعريف جميع الخدمات (الحاويات) التي يتكون منها تطبيقنا
services:

  # الخدمة الأولى: تطبيق Node.js
  app:
    # بدلاً من استخدام صورة جاهزة، اطلب من Compose بناء الصورة
    # من Dockerfile الموجود في المجلد الحالي (.).
    build: .
    ports:
      # اربط المنفذ 3000 على جهازك بالمنفذ 3000 داخل الحاوية
      - "3000:3000"
    volumes:
      # اربط الكود المحلي لتفعيل التحديث المباشر
      - .:/app
    environment:
      # مرر متغيرات البيئة التي يحتاجها التطبيق للاتصال بقاعدة البيانات
      - DB_HOST=db # 'db' هو اسم خدمة قاعدة البيانات أدناه
      - DB_USER=postgres
      - DB_PASSWORD=mysecretpassword
      - DB_NAME=mydb
    # اجعل هذه الخدمة لا تبدأ إلا بعد أن تبدأ خدمة 'db'
    depends_on:
      - db

  # الخدمة الثانية: قاعدة بيانات PostgreSQL
  db:
    # استخدم صورة postgres الرسمية
    image: postgres:14-alpine
    environment:
      # إعدادات لإنشاء قاعدة البيانات والمستخدم تلقائيًا
      - POSTGRES_PASSWORD=mysecretpassword
      - POSTGRES_USER=postgres
      - POSTGRES_DB=mydb
    volumes:
      # حافظ على بيانات قاعدة البيانات بشكل دائم
      - postgres-data:/var/lib/postgresql/data

# تعريف الوحدات التخزينية المُدارة بواسطة Docker
volumes:
  postgres-data:
```
**نقطة مهمة:** داخل شبكة Compose، يمكن للحاويات الوصول إلى بعضها البعض باستخدام **اسم الخدمة** كاسم مضيف (hostname). لهذا السبب، قمنا بتعيين `DB_HOST=db`.

---
### ▶️ 4. أوامر Docker Compose
* **`docker-compose up`**:
    الأمر الرئيسي الذي يقوم ببناء (إذا لزم الأمر)، إنشاء، وبدء جميع الخدمات المحددة في ملف `docker-compose.yml`.
    * أضف `-d` لتشغيل الحاويات في الخلفية: `docker-compose up -d`.
* **`docker-compose down`**:
    يقوم بإيقاف وحذف الحاويات والشبكات التي أنشأها `up`.
* **`docker-compose logs -f [service_name]`**:
    لعرض سجلات خدمة معينة في الوقت الفعلي (مثل `docker-compose logs -f app`).
* **`docker-compose build`**:
    لإعادة بناء الصور يدويًا إذا قمت بتغيير `Dockerfile`.

---
