## 🌐 الوحدة 2: بروتوكولات الويب وواجهات برمجة التطبيقات

### 📘 الدرس 3: مقدمة في WebSockets

#### 🧠 **ماذا ستتعلم**
* ما هي WebSockets والمشكلة التي تحلها.
* الفرق بين نموذج طلب/استجابة HTTP واتصال WebSocket ثنائي الاتجاه.
* كيف يتم بدء اتصال WebSocket.
* حالات الاستخدام الشائعة لـ WebSockets.

---
### 🤔 1. محدودية بروتوكول HTTP
كما تعلمنا، يعمل بروتوكول HTTP بنظام **الطلب والاستجابة (Request-Response)**. هذا يعني أن العميل يجب أن يبدأ الاتصال دائمًا عن طريق إرسال طلب، ولا يمكن للخادم إرسال بيانات إلى العميل إلا كرد على هذا الطلب.

**المشكلة:** ماذا لو كان الخادم لديه معلومات جديدة يريد إرسالها إلى العميل فورًا (مثل رسالة دردشة جديدة، أو تحديث لسعر سهم)؟ في نموذج HTTP التقليدي، يجب على العميل أن يسأل الخادم بشكل متكرر: "هل هناك أي جديد؟"، وهي عملية غير فعالة تسمى **Polling**.

---
### 🔌 2. الحل: WebSockets
بروتوكول WebSocket هو تقنية اتصالات توفر قناة اتصال **كاملة الازدواج (Full-Duplex)** عبر اتصال TCP واحد وطويل الأمد.

* **ما معنى "كامل الازدواج"؟**
    * يعني أن الاتصال يمكن أن يتدفق في **كلا الاتجاهين في نفس الوقت**.
    * يمكن للعميل إرسال بيانات إلى الخادم، ويمكن للخادم أيضًا **دفع (push)** البيانات إلى العميل في أي وقت، دون أن يضطر العميل إلى طلبها أولاً.

> **ببساطة:**
> * **HTTP** يشبه إرسال **الرسائل النصية**: ترسل رسالة (طلب) وتنتظر الرد (استجابة). المحادثة عبارة عن سلسلة من التبادلات المنفصلة.
> * **WebSocket** يشبه إجراء **مكالمة هاتفية حية**: بمجرد إنشاء الاتصال، يمكن للطرفين التحدث والاستماع في نفس الوقت، ويبقى الخط مفتوحًا طوال مدة المكالمة.

---
### 🤝 3. كيف يعمل اتصال WebSocket؟
يبدأ اتصال WebSocket حياته كطلب HTTP عادي، ولكنه طلب خاص يطلب "ترقية" الاتصال.

1.  **المصافحة (The Handshake):** يرسل العميل طلب HTTP عادي إلى الخادم، ولكنه يحتوي على ترويسة خاصة: `Upgrade: websocket`.
2.  **الترقية:** إذا كان الخادم يدعم WebSockets، فإنه يوافق على الترقية ويرسل استجابة خاصة.
3.  **إنشاء الاتصال:** بمجرد نجاح الترقية، يتم التخلص من بروتوكول HTTP، ويتم الحفاظ على اتصال TCP الأساسي مفتوحًا. يصبح هذا الاتصال الآن قناة WebSocket ثنائية الاتجاه.

يستخدم WebSocket مخططات URL خاصة به: `ws://` (للاتصالات غير الآمنة) و `wss://` (للاتصالات الآمنة)، وهي تشبه `http://` و `https://`.

---
### 💡 4. متى نستخدم WebSockets؟
تعتبر WebSockets مثالية لأي تطبيق يتطلب تحديثات **منخفضة التأخير (low-latency)** و **في الوقت الفعلي (real-time)** من الخادم إلى العميل.

* **أمثلة شائعة:**
    * **تطبيقات الدردشة:** لدفع الرسائل الجديدة فورًا إلى جميع المشاركين.
    * **الألعاب متعددة اللاعبين عبر الإنترنت:** لإرسال حركات اللاعبين وتحديثات حالة اللعبة في الوقت الفعلي.
    * **بيانات البورصة والعملات المشفرة:** لعرض تحديثات الأسعار الحية.
    * **الإشعارات الفورية:** مثل إشعارات وسائل التواصل الاجتماعي.
    * **أدوات التحرير التعاوني:** مثل Google Docs، حيث يمكنك رؤية ما يكتبه الآخرون في نفس اللحظة.

---
