## 🚀 الوحدة 3: بناء تطبيقات متكاملة

### 📘 الدرس 3 : محركات القوالب (Template Engines)

#### 🧠 **ماذا ستتعلم**
* ما هو التصيير من جانب الخادم (Server-Side Rendering - SSR).
* ما هو محرك القوالب وكيف يعمل.
* كيفية إعداد واستخدام محرك القوالب EJS مع Express.
* كيفية تمرير بيانات ديناميكية من الخادم إلى قالب HTML.

---
### 🖥️ 1. ما هو التصيير من جانب الخادم (SSR)؟
في معظم الدروس حتى الآن، كنا نرسل بيانات JSON من خلال API. لكن في تطبيقات الويب التقليدية، يقوم الخادم بإنشاء **صفحة HTML كاملة** ويرسلها جاهزة إلى المتصفح. هذه العملية تسمى التصيير من جانب الخادم (SSR).

* **SSR (Server-Side Rendering):** يقوم الخادم ببناء الـ HTML بالكامل وإرساله جاهزًا للعرض.
* **CSR (Client-Side Rendering):** (النموذج الشائع مع أطر العمل مثل React و Vue) يرسل الخادم ملف HTML شبه فارغ وملف JavaScript ضخم. يقوم المتصفح بتشغيل الجافاسكريبت لبناء الصفحة وجلب البيانات.

> **ببساطة:**
> * **SSR** يشبه طلب وجبة جاهزة من مطعم. تصلك كاملة وجاهزة للأكل.
> * **CSR** يشبه شراء مكونات الوجبة مع الوصفة. عليك أن تطبخها بنفسك في المنزل.

---
### 📝 2. ما هو محرك القوالب؟
محرك القوالب هو أداة تسمح لنا بكتابة "قوالب" HTML تحتوي على عناصر ديناميكية (متغيرات، حلقات، شروط). يقوم الخادم باستخدام هذا المحرك لأخذ القالب، وملء الفراغات بالبيانات الحقيقية، ثم إنتاج ملف HTML نهائي لإرساله إلى العميل.

**أشهر المحركات لـ Express:**
* **EJS (Embedded JavaScript):** سهل جدًا لأنه يستخدم نفس صيغة HTML مع إضافة وسوم خاصة للجافاسكريبت. (هذا ما سنستخدمه).
* **Pug (سابقًا Jade):** يستخدم صيغة مختصرة تعتمد على المسافات البادئة بدلاً من وسوم HTML الكاملة.
* **Handlebars:** يستخدم وسومًا تشبه `{{variable}}`.

---
### 🛠️ 3. استخدام EJS مع Express

#### **الخطوة 1: تثبيت EJS**
```bash
npm install ejs
```

#### **الخطوة 2: إعداد Express**
في ملف `index.js`، أخبر Express أنك ستستخدم EJS كمحرك قوالب.
```javascript
// ...
// تعيين EJS كمحرك القوالب
app.set('view engine', 'ejs');
// بشكل افتراضي، سيبحث Express عن القوالب في مجلد اسمه 'views'
// ...
```
الآن، أنشئ مجلدًا جديدًا في جذر مشروعك باسم `views`.

#### **الخطوة 3: إنشاء قالب EJS**
داخل مجلد `views`، أنشئ ملفًا جديدًا باسم `profile.ejs`.
**صيغة EJS الأساسية:**
* `<%= variable %>`: لطباعة قيمة متغير (مع تجنب الأكواد الخبيثة).
* `<% logic %>`: لتنفيذ كود جافاسكريبت مثل الحلقات والشروط.

**محتوى `views/profile.ejs`:**
```html
<!DOCTYPE html>
<html lang="en">
<head>
  <title><%= pageTitle %></title>
</head>
<body>
  <h1>Welcome, <%= user.name %>!</h1>
  <p>Your email is: <%= user.email %></p>

  <h2>Your Skills:</h2>
  <ul>
    <% skills.forEach(skill => { %>
      <li><%= skill %></li>
    <% }) %>
  </ul>
</body>
</html>
```

#### **الخطوة 4: تصيير القالب من المسار**
الآن، في `index.js`، بدلاً من `res.send()` أو `res.json()`، سنستخدم `res.render()`.
* **المعامل الأول:** اسم ملف القالب (بدون امتداد `.ejs`).
* **المعامل الثاني:** كائن يحتوي على البيانات التي نريد تمريرها إلى القالب.

```javascript
app.get('/profile', (req, res) => {
  const userData = {
    name: 'Jameel',
    email: 'jameel@example.com'
  };

  const userSkills = ['Node.js', 'Express', 'JavaScript'];

  res.render('profile', {
    pageTitle: 'User Profile',
    user: userData,
    skills: userSkills
  });
});
```
شغل الخادم واذهب إلى `http://localhost:3000/profile` لترى صفحة HTML التي تم إنشاؤها ديناميكيًا!

---

