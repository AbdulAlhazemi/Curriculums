## 🧪 الوحدة 1: أساسيات الاختبار وإعداد البيئة

### 📘 الدرس 4: كتابة اختبارات الوحدة مع Jest

#### 🧠 **ماذا ستتعلم**
* كيفية هيكلة الاختبارات بشكل منظم باستخدام `describe` و `it`.
* مجموعة متنوعة من دوال المطابقة (Matchers) الشائعة في Jest.
* كيفية اختبار القيم المنطقية (Truthy/Falsy).
* كيفية التعامل مع المصفوفات والكائنات في الاختبارات.
* كيفية اختبار الأخطاء المتوقعة (`toThrow`).

---
### 🏗️ 1. هيكلة الاختبارات: `describe` و `it`
يوفر Jest دالتين رئيسيتين لتنظيم اختباراتك:

1.  **`describe(name, fn)`:**
    تستخدم لإنشاء **"مجموعة اختبار" (Test Suite)**. هي ببساطة حاوية لتجميع الاختبارات ذات الصلة معًا. يمكنك تداخل `describe` داخل بعضها البعض لتنظيم أكثر دقة.

2.  **`it(name, fn)`:** (أو الاسم المستعار `test`)
    تستخدم لتعريف **"حالة اختبار" (Test Case)** فردية. يجب أن يكون الاسم عبارة عن جملة وصفية تشرح ما الذي يتم اختباره (مثال: `'should return true for even numbers'`).

**مثال على الهيكل:**
```javascript
describe('calculator module', () => {

  describe('add function', () => {
    it('should handle positive numbers', () => { /* ... */ });
    it('should handle negative numbers', () => { /* ... */ });
  });

  describe('subtract function', () => {
    it('should subtract numbers correctly', () => { /* ... */ });
  });

});
```
---
### 🔬 2. قوة `expect`: أشهر دوال المطابقة (Matchers)
دالة المطابقة هي التي تقوم بالمقارنة الفعلية. هي تأتي دائمًا بعد `expect(value)`.

| دالة المطابقة (Matcher) | الوصف | مثال |
| :--- | :--- | :--- |
| **`.toBe(value)`** | تتحقق من المساواة الصارمة (`===`). مثالية للقيم الأولية (أرقام، نصوص، قيم منطقية). | `expect(2 + 2).toBe(4);` |
| **`.toEqual(value)`** | تتحقق من "المساواة العميقة". استخدمها لمقارنة **الكائنات والمصفوفات**. هي تتحقق من أن لهما نفس الهيكل والقيم. | `expect({a: 1}).toEqual({a: 1});` |
| **`.toBeTruthy()`** | تتحقق مما إذا كانت القيمة "صحيحة" (truthy)، أي أنها لا تساوي `false`, `0`, `""`, `null`, `undefined`, `NaN`. | `expect("hello").toBeTruthy();` |
| **`.toBeFalsy()`** | تتحقق مما إذا كانت القيمة "خاطئة" (falsy). | `expect(0).toBeFalsy();` |
| **`.toContain(item)`** | للمصفوفات، تتحقق مما إذا كانت تحتوي على عنصر معين. | `expect(['a', 'b', 'c']).toContain('b');` |
| **`.toHaveLength(num)`**| تتحقق من طول مصفوفة أو سلسلة نصية. | `expect([1, 2, 3]).toHaveLength(3);` |
| **`.not`** | كلمة خاصة تأتي قبل أي Matcher لعكس النتيجة. | `expect(result).not.toBeNull();` |

---
### 🚨 3. اختبار الأخطاء المتوقعة
كيف نختبر دالة يُفترض بها أن تطلق خطأ (`throw an error`)؟ لا يمكننا استدعاؤها مباشرة لأنها ستؤدي إلى فشل الاختبار.

**الحل هو استخدام `.toThrow()`:**
يجب عليك تغليف استدعاء الدالة داخل دالة أخرى (`() => { ... }`) حتى يتمكن Jest من التقاط الخطأ والتحقق منه.

**مثال:**
```javascript
function divide(a, b) {
  if (b === 0) {
    throw new Error('Division by zero is not allowed.');
  }
  return a / b;
}

// الاختبار
it('should throw an error when dividing by zero', () => {
  // لاحظ كيف تم تغليف استدعاء الدالة
  expect(() => {
    divide(10, 0);
  }).toThrow('Division by zero is not allowed.'); // يمكن التحقق من نص رسالة الخطأ أيضًا
});
```
---
