## 🧪 الوحدة 1: أساسيات الاختبار وإعداد البيئة

### 📘 الدرس 2: اختبارات الوحدة (Unit Testing)

#### 🧠 **ماذا ستتعلم**
* ما هو اختبار الوحدة (Unit Test) بالتحديد.
* أهمية مبدأ "العزل" (Isolation) في اختبارات الوحدة.
* هيكل الاختبار باستخدام نمط "AAA" (Arrange, Act, Assert).
* خصائص اختبار الوحدة الجيد.

---
### 🤔 1. ما هو اختبار الوحدة؟
اختبار الوحدة هو نوع من الاختبارات الآلية يقوم بفحص **أصغر جزء قابل للاختبار** في التطبيق، والذي يسمى "وحدة" (Unit). عادةً ما تكون الوحدة عبارة عن دالة واحدة، أو method في كلاس.

الهدف هو التحقق من أن كل "لبنة بناء" في تطبيقك تعمل بشكل صحيح ومنطقي **بمفردها**، قبل تجميعها مع اللبنات الأخرى.

> **ببساطة:** بالعودة إلى مثال مصنع السيارات، اختبار الوحدة لا يختبر السيارة بأكملها، ولا حتى المحرك بأكمله. إنه يختبر **شمعة احتراق (spark plug) واحدة** للتأكد من أنها تطلق شرارة بشكل صحيح عند تزويدها بالكهرباء.

---
### 🔬 2. مبدأ العزل (Isolation)
هذا هو المبدأ الأكثر أهمية في اختبارات الوحدة. يجب أن يختبر اختبار الوحدة **الوحدة نفسها فقط**، وليس اعتمادياتها (dependencies) مثل الوحدات الأخرى، أو قواعد البيانات، أو واجهات API الخارجية.

* **لماذا؟** إذا فشل اختبار الوحدة، فإنك تعرف بنسبة 100% أن الخطأ موجود **داخل تلك الوحدة**، وليس في مكان آخر. هذا يجعل عملية تصحيح الأخطاء (debugging) سريعة ومباشرة. إذا اختبرت وحدتين معًا وفشل الاختبار، فلن تعرف أيهما سبب المشكلة.
* **كيف؟** لتحقيق العزل، نستخدم تقنيات مثل **"المحاكاة" (Mocking)**، حيث نقوم بإنشاء نسخ وهمية من الاعتماديات تتصرف بطريقة متوقعة. (سنتناول هذا بالتفصيل في درس لاحق).

---
### 📐 3. هيكل اختبار الوحدة: نمط "AAA"
"AAA" هو اختصار لـ **Arrange, Act, Assert**، وهو نمط شائع لتنظيم وهيكلة كود الاختبار لجعله واضحًا وسهل القراءة.

1.  **Arrange (الترتيب):** في هذا الجزء، تقوم بإعداد كل الشروط المسبقة والمدخلات اللازمة للاختبار. تقوم بإنشاء أي متغيرات أو كائنات وهمية (mocks) تحتاجها.
2.  **Act (التنفيذ):** في هذا الجزء، تقوم بتنفيذ الإجراء الفعلي، أي استدعاء الدالة أو الـ method الذي تريد اختباره.
3.  **Assert (التأكيد):** في هذا الجزء، تتحقق مما إذا كانت النتيجة التي حصلت عليها من خطوة "التنفيذ" تتطابق مع النتيجة المتوقعة. هذه هي الخطوة التي تحدد نجاح أو فشل الاختبار.

**مثال بسيط (بدون إطار عمل):**
```javascript
// الوحدة التي نريد اختبارها
function calculateDiscount(price, percentage) {
  return price * (percentage / 100);
}

// الاختبار
// 1. Arrange
const originalPrice = 200;
const discountPercentage = 10;
const expectedDiscount = 20;

// 2. Act
const actualDiscount = calculateDiscount(originalPrice, discountPercentage);

// 3. Assert
if (actualDiscount === expectedDiscount) {
  console.log('✅ Test Passed!');
} else {
  console.error(`❌ Test Failed! Expected ${expectedDiscount}, got ${actualDiscount}`);
}
```
أطر العمل مثل Jest تقوم بأتمتة خطوة "Assert" بطرق أكثر قوة.

---
### ⭐ 4. خصائص اختبار الوحدة الجيد
* **سريع (Fast):** يجب أن يعمل في أجزاء من الثانية. ستقوم بتشغيله مئات المرات في اليوم.
* **معزول (Isolated):** لا يعتمد على اختبارات أخرى أو أنظمة خارجية (مثل الشبكة أو قاعدة البيانات).
* **قابل للتكرار (Repeatable):** ينتج نفس النتيجة في كل مرة يتم تشغيله فيها.
* **ذاتي التحقق (Self-Validating):** يجب أن يكون الاختبار قادرًا على تحديد النجاح أو الفشل بنفسه دون تدخل يدوي.
* **مكتوب في الوقت المناسب (Timely):** يجب كتابته في نفس وقت كتابة الكود الذي يختبره.

---


