## 🧪 الوحدة 1: أساسيات الاختبار وإعداد البيئة

### 📘 الدرس 3: إعداد إطار عمل الاختبار (Jest)

#### 🧠 **ماذا ستتعلم**
* ما هو إطار عمل الاختبار (Testing Framework).
* لماذا سنختار Jest كإطار عمل لنا.
* كيفية تثبيت وإعداد Jest في مشروع Node.js.
* كيفية هيكلة ملفات الاختبار.
* كيفية تشغيل الاختبارات باستخدام npm script.

---
### 🤔 1. ما هو إطار عمل الاختبار؟
إطار عمل الاختبار هو مجموعة من الأدوات والقواعد التي تبسط عملية كتابة وتنظيم وتشغيل الاختبارات الآلية. بدلاً من كتابة منطق `if/else` يدويًا للتحقق من النتائج (كما فعلنا في مثال الدرس السابق)، يوفر إطار العمل:
* **مشغل اختبار (Test Runner):** برنامج يكتشف ملفات الاختبار وينفذها.
* **مكتبة تأكيد (Assertion Library):** توفر دوال سهلة القراءة للتحقق من أن النتائج تطابق التوقعات (مثل `expect(result).toBe(5)`).
* **هيكل تنظيمي:** يوفر دوال مثل `describe` و `it` لتنظيم الاختبارات في مجموعات وحالات اختبار واضحة.

---
### ✨ 2. لماذا نختار Jest؟
Jest هو إطار عمل اختبار "الكل في واحد" تم تطويره بواسطة فيسبوك. سنختاره لعدة أسباب:
* **الكل في واحد (All-in-One):** يأتي مع كل ما تحتاجه (مشغل، مكتبة تأكيد، أدوات محاكاة) في حزمة واحدة.
* **بدون إعداد (Zero Configuration):** يعمل بشكل مباشر لمعظم مشاريع جافاسكريبت دون الحاجة إلى ملفات إعداد معقدة.
* **سهولة الاستخدام:** يوفر رسائل خطأ واضحة ومفيدة تساعد في تصحيح الأخطاء بسرعة.
* **شائع وقوي:** يستخدم على نطاق واسع في الصناعة، مما يجعله مهارة قيمة.

---
### ⚙️ 3. خطوات إعداد Jest

#### **الخطوة 1: تثبيت Jest**
يجب تثبيت Jest كـ **"تبعية تطوير" (dev dependency)** لأنه أداة نحتاجها فقط أثناء التطوير وليس في التطبيق النهائي.
```bash
# في جذر مشروعك
npm install --save-dev jest
```

#### **الخطوة 2: إعداد `package.json`**
أفضل طريقة لتشغيل الاختبارات هي عبر npm script. افتح ملف `package.json` وعدّل قسم `scripts`:
```json
// package.json
{
  // ... other properties
  "scripts": {
    "test": "jest"
  },
  // ...
}
```
الآن، يمكنك تشغيل جميع اختباراتك ببساطة عن طريق تنفيذ الأمر `npm test` في الطرفية.

#### **الخطوة 3: تسمية ملفات الاختبار**
يقوم Jest تلقائيًا بالبحث عن ملفات الاختبار التي تتبع نمط تسمية معين. أشهر نمط هو:
`filename.test.js`
على سبيل المثال، الاختبارات الخاصة بملف `math.js` ستكون في ملف اسمه `math.test.js`.

---
### ✍️ 4. كتابة أول ملف اختبار
لنرَ كيف نختبر دالة بسيطة.

**1. الكود الذي سنختبره (`math.js`):**
```javascript
// math.js
function sum(a, b) {
  return a + b;
}
module.exports = sum;
```

**2. ملف الاختبار المقابل (`math.test.js`):**
```javascript
// math.test.js
const sum = require('./math');

// describe: تستخدم لتجميع الاختبارات ذات الصلة معًا في "مجموعة اختبار"
describe('sum function', () => {

  // it (أو test): تعرف حالة اختبار فردية
  it('should correctly add two positive numbers', () => {
    // Arrange
    const num1 = 1;
    const num2 = 2;

    // Act
    const result = sum(num1, num2);

    // Assert
    // expect: تبدأ جملة التأكيد
    // toBe: هي "matcher" تتحقق من المساواة الصارمة (===)
    expect(result).toBe(3);
  });

});
```
---
### ▶️ 5. تشغيل الاختبارات
الآن، في طرفيتك، نفذ الأمر:
```bash
npm test
```
إذا كان كل شيء صحيحًا، يجب أن ترى مخرجات ناجحة من Jest:
```
PASS  ./math.test.js
 ✓ should correctly add two positive numbers (2 ms)

Test Suites: 1 passed, 1 total
Tests:       1 passed, 1 total
Snapshots:   0 total
Time:        0.45 s
```
---
