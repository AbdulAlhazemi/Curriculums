## 🧪 الوحدة 3: استراتيجيات ومقاييس الاختبار

### 📘 الدرس 1: تغطية الكود (Code Coverage)

#### 🧠 **ماذا ستتعلم**
* ما هي تغطية الكود وماذا تقيس.
* الأنواع المختلفة لمقاييس التغطية (الجمل، الفروع، الدوال).
* كيفية إنشاء تقرير تغطية باستخدام Jest.
* كيفية قراءة التقرير والاستفادة منه.
* لماذا الوصول إلى تغطية 100% ليس دائمًا هو الهدف الأسمى.

---
### 🤔 1. ما هي تغطية الكود؟
تغطية الكود هي مقياس (metric) يوضح **النسبة المئوية من الكود المصدري لتطبيقك التي تم تنفيذها** أثناء تشغيل مجموعة الاختبارات الآلية الخاصة بك. ببساطة، هي تخبرك ما هي أجزاء الكود التي "لمستها" اختباراتك وما هي الأجزاء التي تم تجاهلها تمامًا.

**الغرض منها:** تساعدك على اكتشاف الأجزاء غير المختبرة أو التي لم يتم اختبارها بشكل كافٍ في تطبيقك.

> **ببساطة:** تخيل أن الكود الخاص بك هو خريطة مدينة، واختباراتك هي الطرق التي قدت سيارتك فيها. تقرير تغطية الكود يريك الشوارع التي مررت بها (المغطاة) والشوارع التي لم تزرها أبدًا (غير المغطاة). التقرير لا يخبرك إذا كنت قد قدت بشكل جيد في هذه الشوارع، بل يخبرك فقط أنك مررت بها.

---
### 📊 2. أنواع مقاييس التغطية
تقارير التغطية عادة ما تعرض عدة مقاييس:

* **تغطية الجمل (Statement Coverage):** ما هي النسبة المئوية للجمل البرمجية (الأسطر القابلة للتنفيذ) التي تم تشغيلها؟ هذا هو المقياس الأساسي.
* **تغطية الفروع (Branch Coverage):** ما هي النسبة المئوية للفروع المنطقية (مثل مساري `if` و `else` في جملة شرطية) التي تم اتخاذها؟ هذا المقياس أكثر قيمة من تغطية الجمل، لأنه قد يكون لديك تغطية جمل 100% ولكن تغطية فروع 50% فقط إذا لم تختبر حالة `else`.
* **تغطية الدوال (Function Coverage):** ما هي النسبة المئوية للدوال التي تم استدعاؤها على الأقل مرة واحدة؟
* **تغطية الأسطر (Line Coverage):** مشابهة جدًا لتغطية الجمل.

---
### ⚙️ 3. إنشاء تقرير تغطية باستخدام Jest
إنشاء تقرير تغطية في Jest أمر بسيط للغاية. كل ما عليك فعله هو إضافة خيار `--coverage` إلى أمر الاختبار.

**الطريقة الأفضل هي تعديل `package.json`:**
```json
// package.json
"scripts": {
  "test": "jest",
  "coverage": "jest --coverage"
}
```
الآن، يمكنك تشغيل الأمر التالي في طرفيتك:
```bash
npm run coverage
```

**الناتج:**
1.  **في الطرفية:** سيقوم Jest بطباعة جدول ملخص يوضح نسب التغطية لكل ملف.
2.  **تقرير HTML:** الأهم من ذلك، سيقوم Jest بإنشاء مجلد جديد اسمه `/coverage` في مشروعك. بداخله، ستجد تقرير HTML تفاعلي. افتح ملف `lcov-report/index.html` في متصفحك.

سيظهر لك هذا التقرير تفصيلاً دقيقًا لكل ملف، مع تلوين الأسطر التي لم يتم تغطيتها باللون الأحمر، مما يسهل عليك تحديد نقاط الضعف في اختباراتك.

---
### 🎯 4. مغالطة التغطية بنسبة 100%
**نقطة مهمة جدًا:** السعي وراء تغطية كود بنسبة 100% ليس دائمًا هدفًا جيدًا وقد يكون مضيعة للوقت.

* **المشكلة:** قد يؤدي الهوس بنسبة 100% إلى كتابة اختبارات "سيئة" لا قيمة لها، هدفها فقط "لمس" سطر من الكود لرفع النسبة، دون التحقق فعليًا من صحة المنطق.
* **الحقيقة:** **تغطية الكود لا تقيس جودة اختباراتك.** يمكن لاختبار أن يغطي سطراً من الكود دون أن يحتوي على أي `expect` أو تأكيد حقيقي للسلوك.

**ما هو الهدف الجيد؟**
* اهدف إلى **تغطية عالية وذات معنى** (على سبيل المثال، 80-90%) للأجزاء الحرجة والمنطقية في تطبيقك.
* استخدم تقرير التغطية كأداة لاكتشاف **المناطق الكبيرة غير المختبرة تمامًا**، وليس لمطاردة آخر بضع نقاط مئوية.
* ركز على **تغطية الفروع (Branch Coverage)**، فهي مؤشر أفضل على جودة الاختبار من تغطية الجمل فقط.

---
