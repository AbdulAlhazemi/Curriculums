## 🧪 الوحدة 2: اختبارات التكامل و E2E

### 📘 الدرس 3: اختبارات من البداية إلى النهاية (E2E)

#### 🧠 **ماذا ستتعلم**
* ما هو اختبار من البداية إلى النهاية (End-to-End - E2E).
* كيف يختلف اختبار E2E عن اختبارات الوحدة والتكامل.
* إيجابيات وسلبيات اختبارات E2E.
* لمحة عامة عن أشهر أدوات اختبار E2E مثل Cypress و Puppeteer.

---
### 🏔️ 1. قمة هرم الاختبار
لقد بدأنا من قاعدة الهرم باختبارات الوحدة (المكونات الفردية)، ثم صعدنا إلى اختبارات التكامل (كيف تعمل المكونات معًا). الآن نصل إلى القمة: اختبارات E2E.

**التعريف:** اختبار E2E هو منهجية تُستخدم لاختبار تدفق عمل التطبيق بالكامل **من البداية إلى النهاية**، تمامًا كما لو كان **مستخدم حقيقي** يتفاعل معه. هو يحاكي رحلة مستخدم كاملة عبر جميع طبقات النظام.

> **ببساطة:** هذا هو "اختبار القيادة" النهائي للسيارة المجمعة بالكامل. أنت لا تختبر المحرك أو الفرامل فقط، بل تأخذ السيارة بأكملها على طريق حقيقي، في حركة مرور فعلية، وتقودها إلى وجهتك، وتتأكد من أن التجربة بأكملها تعمل كما هو متوقع (بما في ذلك نظام الملاحة، تكييف الهواء، والراديو).

---
### ⚙️ 2. كيف يبدو اختبار E2E؟
لنفترض أننا نريد اختبار تدفق تسجيل مستخدم جديد. سكربت اختبار E2E سيقوم بالخطوات التالية آليًا:
1.  فتح متصفح حقيقي (مثل Chrome).
2.  الانتقال إلى الصفحة الرئيسية للتطبيق.
3.  البحث عن زر "تسجيل" والنقر عليه.
4.  البحث عن حقول الإدخال لاسم المستخدم والبريد الإلكتروني وكلمة المرور.
5.  كتابة نصوص في هذه الحقول.
6.  البحث عن زر "إرسال" والنقر عليه.
7.  الانتظار حتى يتم إعادة توجيه الصفحة (مثلاً، إلى صفحة تسجيل الدخول).
8.  التحقق من وجود رسالة "تم التسجيل بنجاح" على الشاشة.

لاحظ أن هذا الاختبار يمر عبر كل شيء: الواجهة الأمامية (Frontend)، واجهة API الخلفية (Backend)، وقاعدة البيانات، كلها تعمل معًا.

---
### ⚖️ 3. إيجابيات وسلبيات اختبارات E2E

| الإيجابيات ✅ | السلبيات ❌ |
| :--- | :--- |
| **ثقة عالية جدًا:** نجاح اختبار E2E يمنحك أعلى مستوى من الثقة بأن تطبيقك يعمل بشكل صحيح من منظور المستخدم. | **بطيئة جدًا:** تستغرق وقتًا طويلاً للتشغيل لأنها تتضمن فتح متصفحات وانتظار تحميل الصفحات والتفاعل مع أنظمة حقيقية. |
| | **هشة (Brittle):** يمكن أن تفشل بسهولة بسبب تغييرات طفيفة في واجهة المستخدم (مثل تغيير `id` لزر)، حتى لو كانت الوظيفة لا تزال سليمة. |
| | **مكلفة:** كتابتها وصيانتها مكلفة من حيث الوقت والجهد بسبب تعقيدها. |

لهذه الأسباب، يجب أن يكون لديك عدد قليل من اختبارات E2E التي تغطي أهم تدفقات العمل في تطبيقك (مثل التسجيل، تسجيل الدخول، إجراء عملية شراء).

---
### 🧰 4. أشهر أدوات اختبارات E2E

#### **Cypress**
* **الوصف:** إطار عمل حديث ومتكامل مخصص لاختبارات E2E. يُعرف بتجربة المطور الممتازة، ومشغل الاختبارات التفاعلي، والموثوقية العالية. يعمل مباشرة في المتصفح جنبًا إلى جنب مع تطبيقك.
* **الأفضل لـ:** اختبار تطبيقات الويب الحديثة (React, Vue, Angular, etc.).

#### **Puppeteer**
* **الوصف:** مكتبة Node.js طورتها جوجل توفر واجهة برمجية للتحكم في متصفح Chrome/Chromium. هي ليست إطار عمل اختبار كامل، بل أداة قوية لأتمتة المتصفح يمكنك استخدامها مع مشغل اختبارات مثل Jest.
* **الأفضل لـ:** مهام أتمتة المتصفح، استخراج البيانات من الويب (web scraping)، وبناء بيئة اختبار E2E مخصصة.

#### **Playwright**
* **الوصف:** مكتبة أحدث من مايكروسوفت، تشبه Puppeteer ولكن بميزة رئيسية: تدعم جميع المتصفحات الرئيسية (Chromium, Firefox, WebKit/Safari) بنفس الواجهة البرمجية.
* **الأفضل لـ:** اختبارات E2E عبر متصفحات متعددة.

---
