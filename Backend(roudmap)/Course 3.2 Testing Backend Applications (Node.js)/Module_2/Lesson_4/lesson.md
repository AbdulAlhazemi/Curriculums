## 🧪 الوحدة 3: استراتيجيات ومقاييس الاختبار

### 📘 الدرس 4: التطوير الموجه بالاختبار (TDD)

#### 🧠 **ماذا ستتعلم**
* ما هو التطوير الموجه بالاختبار (Test-Driven Development - TDD).
* الخطوات الثلاث لدورة TDD: أحمر، أخضر، إعادة هيكلة (Red-Green-Refactor).
* الفوائد الرئيسية لتبني منهجية TDD.

---
### 🤔 1. ما هو التطوير الموجه بالاختبار؟
التطوير الموجه بالاختبار (TDD) هو عملية تطوير برمجيات تعكس الدورة التقليدية. بدلاً من كتابة الكود الإنتاجي أولاً ثم كتابة الاختبارات له، في TDD، تقوم بكتابة **حالة اختبار آلية فاشلة *قبل* أن تكتب الكود الإنتاجي** اللازم لجعلها تنجح.

الفكرة الأساسية هي أن الاختبارات هي التي "تقود" عملية تطوير التطبيق. لا تكتب أي كود إنتاجي إلا إذا كان هناك اختبار فاشل يتطلب كتابته.

> **ببساطة:** تخيل أنك عالم. أنت أولاً تضع **فرضية** وتصمم **تجربة لاختبارها** (كتابة الاختبار الفاشل). فقط بعد ذلك، تقوم بالعمل الفعلي لإثبات الفرضية (كتابة الكود لجعل الاختبار ينجح).

---
### 🔄 2. دورة TDD: أحمر، أخضر، إعادة هيكلة (Red-Green-Refactor)
TDD هي دورة قصيرة ومتكررة تتكون من ثلاث خطوات بسيطة:

#### **الخطوة 1: أحمر (Red)**
* **الإجراء:** اكتب اختبارًا آليًا صغيرًا لوظيفة جديدة لا وجود لها بعد.
* **النتيجة:** قم بتشغيل الاختبارات. يجب أن **يفشل** هذا الاختبار الجديد (يتحول لونه إلى "أحمر" في معظم مشغلات الاختبار). هذه الخطوة مهمة جدًا لأنها تثبت أن اختبارك يعمل بشكل صحيح (أنه لا يعطي نتيجة إيجابية خاطئة) وأن الميزة غير موجودة بعد.

#### **الخطوة 2: أخضر (Green)**
* **الإجراء:** اكتب **أقل كمية ممكنة من الكود الإنتاجي** اللازمة لجعل الاختبار الفاشل ينجح. الهدف هنا ليس كتابة كود مثالي، بل فقط جعل شريط الاختبار يتحول إلى "أخضر".
* **النتيجة:** قم بتشغيل الاختبارات مرة أخرى. يجب أن **ينجح** الاختبار الجديد الآن.

#### **الخطوة 3: إعادة الهيكلة (Refactor)**
* **الإجراء:** الآن بعد أن أصبح لديك اختبار ناجح يعمل كـ "شبكة أمان"، يمكنك تنظيف الكود الذي كتبته في الخطوة السابقة. قم بتحسين هيكله، إزالة التكرار، وجعله يتبع مبادئ الكود النظيف، مع التأكد من أن الاختبارات لا تزال ناجحة بعد كل تغيير.
* **النتيجة:** لديك كود نظيف، يعمل، ومختبر بالكامل.

بعد ذلك، تبدأ الدورة من جديد مع الميزة الصغيرة التالية.

---
### ⭐ 3. فوائد منهجية TDD
* **تغطية اختبار عالية:** بحكم التعريف، كل جزء من الكود تكتبه له اختبار مقابل، مما يؤدي إلى تغطية اختبار شبه كاملة.
* **التركيز على خطوات صغيرة:** تجبرك على التفكير في المشكلة في شكل زيادات صغيرة وقابلة للإدارة.
* **تصميم أفضل:** كتابة الاختبار أولاً تجبرك على التفكير في كيفية استخدام الكود (الـ API الخاص به)، مما يؤدي غالبًا إلى تصميم أفضل وأكثر نظافة.
* **ثقة عند التغيير:** تعمل الاختبارات كشبكة أمان عند إعادة الهيكلة أو إضافة ميزات جديدة.
* **توثيق حي:** تعمل الاختبارات كتوثيق قابل للتنفيذ لسلوك النظام.

---
