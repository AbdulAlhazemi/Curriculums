## ðŸ§ª Ø§Ù„ÙˆØ­Ø¯Ø© 2: Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ØªÙƒØ§Ù…Ù„ Ùˆ E2E

### ðŸ“˜ Ø§Ù„Ø¯Ø±Ø³ 2: Ø§Ø®ØªØ¨Ø§Ø± Ù†Ù‚Ø§Ø· Ù†Ù‡Ø§ÙŠØ© Express API Ù…Ø¹ Supertest

#### ðŸ§  **Ù…Ø§Ø°Ø§ Ø³ØªØªØ¹Ù„Ù…**
* Ù…Ø§ Ù‡ÙŠ Ù…ÙƒØªØ¨Ø© `supertest` ÙˆÙ„Ù…Ø§Ø°Ø§ Ù†Ø³ØªØ®Ø¯Ù…Ù‡Ø§ Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ§Ø¬Ù‡Ø§Øª API.
* ÙƒÙŠÙÙŠØ© Ø¥Ø¹Ø¯Ø§Ø¯ `supertest` ÙÙŠ Ø¨ÙŠØ¦Ø© Ø§Ø®ØªØ¨Ø§Ø± Jest.
* ÙƒÙŠÙÙŠØ© ÙƒØªØ§Ø¨Ø© Ø§Ø®ØªØ¨Ø§Ø± Ù„Ù†Ù‚Ø·Ø© Ù†Ù‡Ø§ÙŠØ© `GET`.
* ÙƒÙŠÙÙŠØ© ÙƒØªØ§Ø¨Ø© Ø§Ø®ØªØ¨Ø§Ø± Ù„Ù†Ù‚Ø·Ø© Ù†Ù‡Ø§ÙŠØ© `POST`ØŒ Ø¨Ù…Ø§ ÙÙŠ Ø°Ù„Ùƒ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.
* ÙƒÙŠÙÙŠØ© Ø¥Ø¬Ø±Ø§Ø¡ ØªØ£ÙƒÙŠØ¯Ø§Øª (assertions) Ø¹Ù„Ù‰ Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© ÙˆØ¬Ø³Ù…Ù‡Ø§.

---
### ðŸ¤” 1. Ø§Ù„ØªØ­Ø¯ÙŠ ÙˆØ§Ù„Ø£Ø¯Ø§Ø©: Supertest
**Ø§Ù„ØªØ­Ø¯ÙŠ:** ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†Ø§ØŒ Ù…Ù† Ø¯Ø§Ø®Ù„ Ù…Ù„Ù Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±ØŒ Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ø§Øª HTTP Ø¨Ø±Ù…Ø¬ÙŠØ© (Ù…Ø«Ù„ `GET`, `POST`) Ø¥Ù„Ù‰ ØªØ·Ø¨ÙŠÙ‚ Express Ø§Ù„Ø®Ø§Øµ Ø¨Ù†Ø§ØŒ Ø«Ù… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ø³ØªØ¬Ø§Ø¨Ø© HTTP Ø§Ù„ØªÙŠ ÙŠØ¹ÙŠØ¯Ù‡Ø§ØŸ

**Ø§Ù„Ø­Ù„ Ù‡Ùˆ `supertest`:**
Ù‡ÙŠ Ù…ÙƒØªØ¨Ø© Ø´Ù‡ÙŠØ±Ø© ØªÙˆÙØ± ÙˆØ§Ø¬Ù‡Ø© Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø®ÙˆØ§Ø¯Ù… HTTP. Ù‡ÙŠ ØªØ³Ù…Ø­ Ù„Ùƒ Ø¨Ù€ "Ù‚ÙŠØ§Ø¯Ø©" ØªØ·Ø¨ÙŠÙ‚ Express Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ø¨Ø±Ù…Ø¬ÙŠÙ‹Ø§. Ø£ÙØ¶Ù„ Ù…ÙŠØ²Ø© ÙÙŠÙ‡Ø§ Ù‡ÙŠ Ø£Ù†Ù‡Ø§ Ù„Ø§ ØªØªØ·Ù„Ø¨ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù… Ø¹Ù„Ù‰ Ù…Ù†ÙØ° Ø­Ù‚ÙŠÙ‚ÙŠØŒ Ø¨Ù„ ÙŠÙ…ÙƒÙ†Ù‡Ø§ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ø¨Ø§Ø´Ø±Ø©ØŒ Ù…Ù…Ø§ ÙŠØ¬Ø¹Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø£Ø³Ø±Ø¹ ÙˆØ£Ø³Ù‡Ù„ ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯.

---
### âš™ï¸ 2. Ø¥Ø¹Ø¯Ø§Ø¯ Supertest

**Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø§Ù„ØªØ«Ø¨ÙŠØª**
ÙŠØ¬Ø¨ ØªØ«Ø¨ÙŠØªÙ‡Ø§ ÙƒÙ€ "ØªØ¨Ø¹ÙŠØ© ØªØ·ÙˆÙŠØ±" (`dev dependency`).
```bash
npm install --save-dev supertest
```

**Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ ÙÙŠ Ù…Ù„Ù Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±**
1.  Ù‚Ù… Ø¨Ø§Ø³ØªÙŠØ±Ø§Ø¯ `request` Ù…Ù† Ù…ÙƒØªØ¨Ø© `supertest`.
2.  Ù‚Ù… Ø¨Ø§Ø³ØªÙŠØ±Ø§Ø¯ ÙƒØ§Ø¦Ù† `app` Ù…Ù† ØªØ·Ø¨ÙŠÙ‚ Express Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ. (ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù…Ù„Ù `app.js` Ø£Ùˆ `server.js` ÙŠÙ‚ÙˆÙ… Ø¨ØªØµØ¯ÙŠØ± ÙƒØ§Ø¦Ù† `app`).

**Ù…Ø«Ø§Ù„ Ù„Ù„Ù‡ÙŠÙƒÙ„:**
```javascript
// file: books.test.js
const request = require('supertest');
const app = require('../app'); // Ø§ÙØªØ±Ø¶ Ø£Ù† Ù…Ù„ÙÙƒ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù‡Ùˆ app.js
```

---
### âœï¸ 3. ÙƒØªØ§Ø¨Ø© Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù€ API

#### **Ø£. Ø§Ø®ØªØ¨Ø§Ø± Ù†Ù‚Ø·Ø© Ù†Ù‡Ø§ÙŠØ© `GET`**
Ù„Ù†ÙØªØ±Ø¶ Ø£Ù†Ù†Ø§ Ù†Ø®ØªØ¨Ø± `GET /api/books` Ø§Ù„ØªÙŠ Ù…Ù† Ø§Ù„Ù…ÙØªØ±Ø¶ Ø£Ù† ØªØ¹ÙŠØ¯ Ù…ØµÙÙˆÙØ© Ù…Ù† Ø§Ù„ÙƒØªØ¨.
```javascript
describe('GET /api/books', () => {
  it('should respond with a list of books', async () => {
    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¥Ù„Ù‰ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    const response = await request(app).get('/api/books');

    // Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø¹Ù„Ù‰ Ø±Ù…Ø² Ø§Ù„Ø­Ø§Ù„Ø© (Status Code)
    expect(response.statusCode).toBe(200);

    // Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ Ø¬Ø³Ù… Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©
    expect(response.body).toBeInstanceOf(Array);
  });
});
```

#### **Ø¨. Ø§Ø®ØªØ¨Ø§Ø± Ù†Ù‚Ø·Ø© Ù†Ù‡Ø§ÙŠØ© `POST`**
Ù„Ù†ÙØªØ±Ø¶ Ø£Ù†Ù†Ø§ Ù†Ø®ØªØ¨Ø± `POST /api/books` Ø§Ù„ØªÙŠ ØªÙ†Ø´Ø¦ ÙƒØªØ§Ø¨Ù‹Ø§ Ø¬Ø¯ÙŠØ¯Ù‹Ø§. Ù†Ø³ØªØ®Ø¯Ù… Ø¯Ø§Ù„Ø© `.send()` Ù„Ø¥Ø±ÙØ§Ù‚ Ø¬Ø³Ù… Ø§Ù„Ø·Ù„Ø¨.
```javascript
describe('POST /api/books', () => {
  it('should create a new book and respond with it', async () => {
    const newBookData = { title: 'The Test Book', author: 'Jest' };
    
    const response = await request(app)
      .post('/api/books')
      .send(newBookData); // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø¬Ø³Ù… Ø§Ù„Ø·Ù„Ø¨
      
    // Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø¹Ù„Ù‰ Ø±Ù…Ø² Ø§Ù„Ø­Ø§Ù„Ø© (201 Created)
    expect(response.statusCode).toBe(201);
    
    // Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø¹Ù„Ù‰ Ø£Ù† Ø¬Ø³Ù… Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø©
    // toMatchObject ÙŠØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„ÙƒØ§Ø¦Ù† ÙŠØ­ØªÙˆÙŠ (Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„) Ø¹Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„Ø®ØµØ§Ø¦Øµ
    expect(response.body).toMatchObject(newBookData);

    // Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø¹Ù„Ù‰ ÙˆØ¬ÙˆØ¯ Ø®Ø§ØµÙŠØ© 'id' Ø§Ù„ØªÙŠ Ø£Ø¶Ø§ÙØªÙ‡Ø§ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    expect(response.body).toHaveProperty('id');
  });
});
```
---
### ðŸ”— 4. Ø§Ù„ØªÙƒØ§Ù…Ù„ Ù…Ø¹ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
ÙƒÙ…Ø§ ØªØ¹Ù„Ù…Ù†Ø§ ÙÙŠ Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø³Ø§Ø¨Ù‚ØŒ ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø­Ø§Ù„Ø© Ù†Ø¸ÙŠÙØ© ÙˆÙ…Ø¹Ø±ÙˆÙØ© Ù‚Ø¨Ù„ ÙƒÙ„ Ø§Ø®ØªØ¨Ø§Ø±.

**Ù…Ø«Ø§Ù„ ÙŠØ¯Ù…Ø¬ `supertest` Ù…Ø¹ Ø®Ø·Ø§ÙØ§Øª Jest Ù„Ø¥Ø¯Ø§Ø±Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:**
```javascript
const request = require('supertest');
const app = require('../app');
const db = require('../db'); // ÙƒØ§Ø¦Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª

describe('Book Endpoints', () => {

  // Ù‚Ø¨Ù„ ÙƒÙ„ Ø§Ø®ØªØ¨Ø§Ø± ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©ØŒ Ù†Ø¸Ù‘Ù Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙƒØªØ¨
  beforeEach(async () => {
    await db.query('DELETE FROM books');
  });

  // Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„ÙØŒ Ø£ØºÙ„Ù‚ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  afterAll(async () => {
    await db.end();
  });

  it('should create a book and then be able to retrieve it', async () => {
    // 1. Act (POST)
    await request(app)
      .post('/api/books')
      .send({ title: 'My New Book', author: 'Me' });

    // 2. Act (GET)
    const response = await request(app).get('/api/books');

    // 3. Assert
    expect(response.body).toHaveLength(1);
    expect(response.body[0].title).toBe('My New Book');
  });
});
```

---

