## ⚡ الوحدة 2: التخزين المؤقت (Caching) وتحسين الأداء

### 📘 الدرس 2: استراتيجيات التخزين المؤقت (Caching Strategies)

#### 🧠 **ماذا ستتعلم**
* مفهوم التسلسل الهرمي للتخزين المؤقت.
* التخزين المؤقت من جانب العميل (Browser Cache).
* التخزين المؤقت باستخدام شبكات توصيل المحتوى (CDN).
* أنواع التخزين المؤقت من جانب الخادم: في الذاكرة (In-memory) والموزع (Distributed).

---
### 🤔 1. أين يمكننا وضع الكاش؟
التخزين المؤقت ليس استراتيجية واحدة، بل يمكن تطبيقه في عدة **طبقات** بين المستخدم وقاعدة البيانات. القاعدة العامة هي: **كلما كان الكاش أقرب إلى المستخدم، كانت الاستجابة أسرع**.

**التسلسل الهرمي النموذجي للوصول إلى البيانات:**
1.  هل البيانات موجودة في **كاش المتصفح**؟ (الأسرع)
2.  إذا لا، هل هي موجودة في **كاش الـ CDN**؟
3.  إذا لا، هل هي موجودة في **كاش الخادم** (مثل Redis)؟
4.  إذا لا، اذهب إلى **قاعدة البيانات** (الأبطأ).

---
### 💻 2. التخزين المؤقت لدى العميل (Browser Cache)
* **ما هو:** يقوم متصفح الويب الخاص بالمستخدم بتخزين نسخ من الملفات الثابتة (CSS, JavaScript, الصور) على القرص الصلب المحلي للمستخدم.
* **كيف يعمل:** عندما يزور المستخدم موقعك لأول مرة، يقوم المتصفح بتحميل هذه الملفات. يمكن لخادمك إرسال ترويسات HTTP (سنتعلمها في الدرس القادم) تخبر المتصفح "يمكنك إعادة استخدام هذا الملف لمدة 24 ساعة القادمة". في الزيارة التالية، يقوم المتصفح بتحميل الملف مباشرة من جهاز المستخدم بدلاً من إعادة تنزيله من الإنترنت.
* **الأفضل لـ:** الأصول الثابتة التي لا تتغير كثيرًا.

---
### 🌍 3. شبكة توصيل المحتوى (CDN - Content Delivery Network)
* **ما هي:** شبكة موزعة جغرافيًا من الخوادم الوسيطة (Proxy Servers) التي تقوم بتخزين نسخ من المحتوى الثابت الخاص بك في مواقع حول العالم.
* **كيف تعمل:** عندما يطلب مستخدم في لندن صورة من موقعك المستضاف في أمريكا، بدلاً من جلبها عبر المحيط، يتم خدمتها من خادم CDN موجود في لندن أو بالقرب منها.
* **الأفضل لـ:** الأصول الثابتة (صور، فيديوهات، ملفات CSS/JS) التي يتم خدمتها لجمهور عالمي.
* **الفوائد:** تقلل بشكل كبير من زمن الاستجابة للمستخدمين الدوليين وتخفف الحمل عن الخادم الأصلي.

---
### ⚙️ 4. التخزين المؤقت على جانب الخادم (Server-Side Caching)
يحدث هذا داخل البنية التحتية الخلفية الخاصة بك، وهو مصمم لتسريع الاستجابات الديناميكية وتقليل الحمل على قاعدة البيانات.

#### **أ. كاش في الذاكرة (In-Memory Cache)**
* **كيف:** تخزين البيانات المخبأة مباشرة في ذاكرة الوصول العشوائي (RAM) لتطبيقك (على سبيل المثال، في كائن JavaScript أو `Map`).
* **الإيجابيات:** سريع للغاية لأنه لا يتطلب أي اتصال شبكي.
* **السلبيات:**
    * محدود بذاكرة الخادم.
    * تضيع البيانات عند إعادة تشغيل الخادم.
    * لا يعمل بشكل جيد مع عدة نسخ من الخادم (موازنة الأحمال)، حيث سيكون لكل نسخة الكاش الخاص بها بشكل منفصل.

#### **ب. كاش موزع (Distributed Cache)**
* **كيف:** استخدام خادم منفصل ومخصص بالكامل لعملية التخزين المؤقت. يمكن لجميع نسخ تطبيقك الاتصال بهذا الخادم المشترك لمشاركة نفس الكاش.
* **أشهر الأدوات:** **Redis** و **Memcached**.
* **الإيجابيات:** يحل جميع مشاكل الكاش في الذاكرة. هو قابل للتوسع، يمكن أن يكون دائمًا، ومشترك بين جميع الخوادم.
* **السلبيات:** يضيف مكونًا جديدًا إلى بنيتك التحتية لإدارته، وأبطأ قليلاً من الكاش في الذاكرة (بسبب استدعاء الشبكة)، ولكنه لا يزال أسرع بكثير من قاعدة البيانات.

---
