## 🌐 الوحدة 1: خوادم الويب والوكلاء العكسيون (Reverse Proxies)

### 📘 الدرس 4: إعدادات Nginx الأساسية (Server & Location Blocks)

#### 🧠 **ماذا ستتعلم**
* الغرض من كتلة `server` وكيفية هيكلتها.
* كيف يختار Nginx كتلة `server` المناسبة للطلب (باستخدام `listen` و `server_name`).
* الغرض من كتلة `location` وكيفية استخدامها.
* كيفية توجيه المسارات المختلفة بشكل مختلف (مثل توجيه طلبات API إلى Node.js وخدمة الملفات الثابتة مباشرة).

---
### 🏢 1. كتلة الخادم (The `server` Block)
كتلة `server` تحدد إعدادات **خادم افتراضي (virtual server)**. يمكنك أن يكون لديك العديد من كتل `server` في إعدادات Nginx، مما يتيح لك استضافة عدة مواقع أو تطبيقات على نفس الجهاز الفعلي.

> **ببساطة:** تخيل أن جهاز الخادم الخاص بك هو **مركز تسوق (Mall)**. كل كتلة `server` هي بمثابة **متجر منفصل** داخل هذا المركز. كل متجر له اسمه الخاص (domain name) وقواعده الخاصة.

**أهم التوجيهات (Directives) داخل `server`:**
* **`listen`**: تحدد رقم المنفذ (والـ IP اختياريًا) الذي سيستمع عليه هذا الخادم الافتراضي للاتصالات. الأكثر شيوعًا هو `listen 80;` لـ HTTP و `listen 443 ssl;` لـ HTTPS.
* **`server_name`**: تحدد أسماء النطاقات التي يجب أن تستجيب لها هذه الكتلة. يستخدم Nginx هذه القيمة لمطابقة الطلب الوارد مع كتلة `server` الصحيحة.
  ```nginx
  # هذا الخادم سيستجيب للطلبين
  server_name example.com www.example.com;
  ```
---
### 🏘️ 2. استضافة عدة مواقع
باستخدام كتل `server` متعددة، يمكن لـ Nginx بسهولة استضافة موقعين مختلفين على نفس الخادم.

**مثال لملف إعداد واحد يحتوي على موقعين:**
```nginx
# إعدادات الموقع الأول (مدونة)
server {
    listen 80;
    server_name my-blog.com;
    
    # يخدم الملفات من هذا المجلد
    root /var/www/my-blog/public;
    index index.html;
}

# إعدادات الموقع الثاني (تطبيق Node.js)
server {
    listen 80;
    server_name my-app.com;

    location / {
        proxy_pass http://localhost:3000;
    }
}
```

---
### 🚪 3. كتلة الموقع (The `location` Block)
يتم تعريف كتلة `location` **داخل** كتلة `server`. هي تسمح لك بتخصيص كيفية تعامل Nginx مع الطلبات لمسارات URL مختلفة.

> **ببساطة:** إذا كانت كتلة `server` هي "المتجر"، فإن كتل `location` هي **"الأقسام" المختلفة** داخل هذا المتجر (مثل قسم الإلكترونيات، قسم الملابس، خدمة العملاء). كل قسم له قواعده الخاصة.

**الصيغة العامة:** `location /path/ { ... }`

---
### ⚙️ 4. مثال على إعداد عملي
هذا مثال شائع جدًا لتطبيق ويب حديث (مثل تطبيق React أو Vue مع واجهة خلفية Express).

**الهدف:**
* الطلبات التي تبدأ بـ `/api` يجب توجيهها إلى خادم Node.js.
* أي طلب آخر يجب أن يخدم ملفات ثابتة (الواجهة الأمامية).

```nginx
server {
    listen 80;
    server_name my-app.com;

    # يخدم الملفات الثابتة من هذا المجلد
    root /var/www/my-app-frontend/build;
    index index.html;

    # هذا الجزء مهم لتطبيقات الصفحة الواحدة (SPAs)
    # هو يخدم الملفات الثابتة مباشرة، وإذا لم يجدها، يعيد الطلب إلى index.html
    location / {
        try_files $uri /index.html;
    }

    # هذا الجزء يوجه جميع طلبات API إلى الخادم الخلفي
    location /api {
        proxy_pass http://localhost:5000;
        # ... باقي ترويسات البروكسي ...
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```
---
