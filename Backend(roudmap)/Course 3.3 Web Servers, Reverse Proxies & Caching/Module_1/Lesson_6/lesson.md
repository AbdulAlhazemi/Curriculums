## 🌐 الوحدة 1: خوادم الويب والوكلاء العكسيون (Reverse Proxies)

### 📘 الدرس 6: تأمين الخادم باستخدام HTTPS و Nginx

#### 🧠 **ماذا ستتعلم**
* لماذا يعتبر HTTPS ضروريًا لتطبيقات الويب الحديثة.
* مفهوم إنهاء SSL/TLS (SSL/TLS Termination).
* ما هي شهادة SSL وكيفية الحصول عليها (مع لمحة عن Let's Encrypt).
* كيفية إعداد Nginx للاستماع على منفذ 443 واستخدام شهادة SSL.
* كيفية إعادة توجيه جميع طلبات HTTP إلى HTTPS.

---
### 🤔 1. لماذا نحتاج إلى HTTPS؟
بروتوكول **HTTP** القياسي يرسل جميع البيانات كنص عادي. هذا يعني أن أي شخص على الشبكة (مثل شبكة Wi-Fi عامة) يمكنه التجسس على البيانات المتبادلة بين المستخدم والخادم، بما في ذلك كلمات المرور والمعلومات الشخصية.

**HTTPS (HTTP Secure)** يحل هذه المشكلة. هو ببساطة بروتوكول HTTP مع طبقة أمان إضافية تستخدم **SSL/TLS** لتشفير جميع الاتصالات.

* **HTTPS يضمن:**
    * **السرية (Confidentiality):** لا يمكن لأحد قراءة البيانات المشفرة.
    * **السلامة (Integrity):** لا يمكن تعديل البيانات أثناء النقل دون اكتشاف ذلك.
    * **المصادقة (Authentication):** يثبت أنك تتحدث مع الخادم الصحيح وليس مع موقع مزيف.

---
### 💡 2. مفهوم إنهاء SSL/TLS (SSL/TLS Termination)
بدلاً من جعل تطبيق Node.js الخاص بنا يتعامل مع التعقيدات والحمل الحسابي لعمليات التشفير وفك التشفير، يمكننا تفويض هذه المهمة بالكامل إلى Nginx.

**العملية تسمى إنهاء SSL/TLS:**
1.  **اتصال مشفر (Client -> Nginx):** يتصل متصفح المستخدم بـ Nginx على المنفذ `443` باستخدام اتصال `https` آمن ومشفر.
2.  **Nginx ينهي التشفير:** يقوم Nginx بفك تشفير الطلب.
3.  **اتصال غير مشفر (Nginx -> Node.js):** يقوم Nginx بتمرير الطلب بعد فك تشفيره إلى تطبيق Node.js على شبكة داخلية سريعة وآمنة (مثل `http://localhost:3000`).

**الفائدة:** هذا يبسط كود تطبيق Node.js بشكل كبير ويستغل كفاءة Nginx العالية في التعامل مع العمليات المشفرة.

---
### 📜 3. شهادات SSL
لكي تتمكن من استخدام HTTPS، يحتاج خادمك إلى **شهادة SSL**. هذه الشهادة هي ملف رقمي صغير صادر عن جهة موثوقة تسمى **هيئة إصدار الشهادات (Certificate Authority - CA)**. هي تربط اسم النطاق الخاص بك بمفتاح تشفير وتثبت هوية موقعك.

* **كيف تحصل عليها؟**
    * **Let's Encrypt:** هي هيئة إصدار شهادات **مجانية، آلية، ومفتوحة**. لقد جعلت الحصول على شهادات SSL متاحًا للجميع.
    * **Certbot:** هي أداة سطر أوامر تقوم بأتمتة عملية الحصول على شهادات من Let's Encrypt وتجديدها وإعدادها لخادم الويب الخاص بك (مثل Nginx) بسهولة.

---
### ⚙️ 4. إعداد Nginx لـ HTTPS
هذا مثال على ملف إعداد Nginx كامل يقوم بإعادة توجيه HTTP إلى HTTPS ويستخدم شهادة SSL.

**ملاحظة:** ستحتاج إلى اسم نطاق حقيقي وشهادة SSL لتطبيق هذا عمليًا.

```nginx
# الخادم الأول: يستقبل طلبات HTTP ويعيد توجيهها إلى HTTPS
server {
    listen 80;
    server_name your_domain.com;

    # قم بإعادة توجيه دائمة (301) إلى نفس الصفحة ولكن بإصدار https
    return 301 https://$host$request_uri;
}

# الخادم الثاني: يتعامل مع طلبات HTTPS الفعلية
server {
    # استمع على المنفذ 443 وقم بتفعيل SSL
    listen 443 ssl;
    server_name your_domain.com;

    # مسارات ملفات الشهادة (التي ستحصل عليها من Let's Encrypt)
    ssl_certificate /etc/letsencrypt/live/your_domain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/your_domain.com/privkey.pem;

    # ... إعدادات SSL أخرى لتحسين الأمان ...

    location / {
        proxy_pass http://localhost:3000; # تمرير الطلب إلى تطبيق Node.js
        # ... باقي ترويسات البروكسي ...
    }
}
```
---

