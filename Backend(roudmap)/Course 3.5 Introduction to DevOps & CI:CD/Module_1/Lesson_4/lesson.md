## ⚙️ الوحدة 1: أساسيات DevOps و CI/CD

### 📘 الدرس 4: نظرة عامة على مراحل خط أنابيب CI/CD

#### 🧠 **ماذا ستتعلم**
* ما هو خط أنابيب CI/CD.
* المراحل الأربع الأساسية لخط أنابيب نموذجي.
* الغرض من كل مرحلة من المصدر إلى النشر.

---
### 🤔 1. ما هو خط أنابيب CI/CD؟
خط أنابيب CI/CD (CI/CD Pipeline) هو **عملية آلية** تأخذ الكود الجديد من مستودع المصدر، تمرره عبر سلسلة من المراحل، وفي النهاية، تقوم بتسليمه إلى المستخدمين. إنه التطبيق العملي لمفاهيم CI/CD التي تعلمناها.

كل مرحلة في خط الأنابيب هي "بوابة جودة"؛ يجب على الكود أن يجتازها بنجاح للانتقال إلى المرحلة التالية. إذا فشلت أي مرحلة، يتوقف خط الأنابيب ويرسل إشعارًا فوريًا إلى الفريق.

> **ببساطة:** تخيل خط الأنابيب مثل **خط التجميع الآلي في مصنع سيارات**. تدخل المواد الخام (الكود المصدري) من جهة، وتمر عبر عدة محطات (مراحل)، وتخرج سيارة جاهزة ومختبرة (ميزة منشورة) من الجهة الأخرى.

---
### ⚙️ 2. المراحل الأربع الأساسية
على الرغم من أن خطوط الأنابيب يمكن أن تكون معقدة، إلا أنها تتكون عادةً من أربع مراحل رئيسية.

#### **1. مرحلة المصدر (Source Stage) `📝`**
* **المُحفِّز:** تبدأ هذه المرحلة تلقائيًا عندما يقوم مطور بدفع كود جديد إلى المستودع (مثل `git push`).
* **الإجراء:** يقوم خادم الـ CI باكتشاف التغيير، سحب أحدث نسخة من الكود، والتحضير لبدء عملية البناء.

#### **2. مرحلة البناء (Build Stage) `🏗️`**
* **المُحفِّز:** تبدأ بعد نجاح مرحلة المصدر.
* **الإجراء:** في هذه المرحلة، يتم تجميع الكود (إذا كانت اللغة تتطلب ذلك) وتثبيت جميع التبعيات.
    * **لمشروع Node.js:** هذا هو المكان الذي يتم فيه تنفيذ أمر `npm install`.
* **الهدف:** إنتاج "قطعة أثرية" (artifact) قابلة للتشغيل والاختبار، وهي نسخة كاملة من التطبيق مع جميع تبعياته.

#### **3. مرحلة الاختبار (Test Stage) `🧪`**
* **المُحفِّز:** تبدأ بعد نجاح مرحلة البناء. هذه هي بوابة الجودة الأهم.
* **الإجراء:** يتم تشغيل مجموعة الاختبارات الآلية بالكامل. هذا يشمل:
    * تحليل الكود الثابت (Linting).
    * **اختبارات الوحدة (Unit Tests).**
    * **الاختبارات التكاملية (Integration Tests).**
* **النتيجة:** إذا فشل أي اختبار، **يتوقف خط الأنابيب فورًا** ويبلغ المطور بالخطأ. لا يمكن للكود المعيب المتابعة.

#### **4. مرحلة النشر (Deploy Stage) `🚀`**
* **المُحفِّز:** تعمل هذه المرحلة **فقط إذا نجحت جميع المراحل السابقة**.
* **الإجراء:** يتم أخذ القطعة الأثرية التي تم بناؤها واختبارها ونشرها في بيئة معينة.
    * في **التسليم المستمر (Continuous Delivery)**: قد يتم النشر تلقائيًا إلى بيئة الاختبار المرحلي (Staging).
    * في **النشر المستمر (Continuous Deployment)**: قد يتم النشر تلقائيًا مباشرة إلى بيئة الإنتاج ليراها المستخدمون.

---
### 🗺️ 3. تصور خط الأنابيب

**`دفع الكود`** → `[مرحلة المصدر]` → `[مرحلة البناء]` → `[مرحلة الاختبار]` → **(إذا نجح ✅)** → `[مرحلة النشر]`

↘ **(إذا فشل ❌)** → **`إبلاغ المطور`**

---
