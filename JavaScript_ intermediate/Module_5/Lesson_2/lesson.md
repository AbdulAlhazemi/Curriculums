# الوحدة 5: وقت تشغيل جافاسكريبت والعمليات الداخلية

## الدرس 2: كيف تعمل JavaScript تحت الغطاء

🧠 **ماذا ستتعلم**
* الفرق بين الترجمة (Compilation) والتفسير (Interpretation)
* ما هو محرك JavaScript وكيف يعالج الشيفرة
* الخطوات التي تمر بها الشيفرة من الكتابة إلى التنفيذ
* المفاهيم الأساسية مثل JIT والذاكرة المؤقتة

---

🧾 **1. ترجمة أم تفسير؟**

JavaScript لغة **ديناميكية** كانت تُفسَّر بالكامل في الماضي.
لكن المحركات الحديثة مثل V8 (في Chrome وNode.js) أصبحت تستخدم **الترجمة الفورية** (Just-In-Time Compilation أو JIT)، لتحسين الأداء.

💡 **الفرق الأساسي:**

- **التفسير (Interpretation):** تُنفّذ الشيفرة مباشرة، سطرًا بسطر.
- **الترجمة (Compilation):** تُحوّل الشيفرة إلى صيغة وسيطة (Bytecode) تُنفذ لاحقًا بشكل أسرع.

---

🛠️ **2. كيف تُنفّذ الشيفرة؟**

تمرّ شيفرة JavaScript بعدة مراحل قبل أن تُنفذ:

1.  كتابة الكود
    ↓
2.  التحليل اللغوي (Parsing)
    ↓
3.  إنشاء شجرة بناء مجردة (AST)
    ↓
4.  الترجمة إلى Bytecode
    ↓
5.  التنفيذ عبر المحرك

📌 **AST (شجرة البناء المجردة)** هي تمثيل هيكلي للكود — أشبه بترجمة الكود إلى شجرة من التعليمات يفهمها المحرك.

---

🧠 **مثال عملي:**

```javascript
let x = 5;
let y = x + 2;
console.log(y);
```

يمر هذا الكود بالمراحل التالية:
1.  **التحليل** ➝ فهم بناء الجملة
2.  **الترجمة** ➝ إنشاء Bytecode
3.  **التنفيذ** ➝ تخزين x, حساب x + 2, ثم الطباعة

---

⚙️ **3. ما هو محرك JavaScript؟**

هو البرنامج الذي يقوم بتحليل وتشغيل الشيفرة. من أشهر المحركات:

| المحرك | يُستخدم في |
| :--- | :--- |
| **V8** | Google Chrome, Node.js |
| **SpiderMonkey** | Firefox |
| **JavaScriptCore** | Safari |
| **Bun Engine** | Bun (مبني بلغة Zig) |

كل محرك يحتوي على:
* **Parser:** لتحليل الكود
* **Interpreter:** لتنفيذه مباشرة
* **Compiler (JIT):** لتحسين الأداء بترجمة الأجزاء المتكررة

---

🔍 **4. التحسينات التلقائية (Optimizations)**

محركات JavaScript ذكية جدًا. أثناء التشغيل، تقوم بـ:
* تحليل أداء الوظائف
* ترجمة الوظائف المتكررة إلى Bytecode سريع
* تحسين استخدام الذاكرة
* تجاهل الشيفرة غير المستخدمة (Dead Code Elimination)

---

🧪 **جرب بنفسك**

جرب كتابة هذا الكود وشاهد كيف يعمل:

```javascript
function add(a, b) {
  return a + b;
}

console.log(add(3, 7));
```

🔎 حاول تتبع ما يحدث:
1.  **تعريف الدالة** ➝ تُخزن في الذاكرة
2.  **تنفيذ `add(3, 7)`** ➝ يُضاف إلى المكدس (Call Stack)
3.  **النتيجة تُعاد** ➝ وتُطبع في وحدة التحكم

---

👁️‍🗨️ **مثال من الواقع**

عند فتح موقع ويب، محرك JavaScript يبدأ بتحليل كل الشيفرة من الملفات المرتبطة (`script.js` مثلاً).
يقوم بتحليلها، ترجمتها، ثم تشغيلها — وكل ذلك في أجزاء من الثانية.

---

🔍 **حقيقة ممتعة**

محرك V8 في Chrome يترجم الكود إلى لغة منخفضة المستوى تشبه لغة الآلة (Machine Code)،
مما يجعل التنفيذ سريعًا جدًا — وهذا من أسباب أداء Node.js العالي أيضًا.

---

🚀 **ماذا بعد؟**

في الدرس التالي، سنتعمق في سياقات التنفيذ (Execution Contexts) ونتعرّف على كيف تُخزَّن المتغيرات، وتُنفّذ الوظائف، وتُدار المكدسات (Call Stack) في JavaScript.

---

هل تود أن أجهز **الدرس 3** لك الآن بنفس النمط؟