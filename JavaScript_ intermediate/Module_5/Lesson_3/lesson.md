# الوحدة 5: وقت تشغيل جافاسكريبت والعمليات الداخلية
**(JavaScript Runtime & Internals)**

## الدرس 3: سياقات التنفيذ والمكدس (Execution Context & Call Stack)

🧠 **ماذا ستتعلم**
* ما هو سياق التنفيذ (Execution Context)
* كيف يعمل المكدس (Call Stack)
* الفرق بين السياق العام وسياقات الوظائف
* مفهوم "Hoisting" (رفع التعاريف)
* كيف تتعامل JavaScript مع الخطأ عند تكدس المكدس

---

### 🧾 1. ما هو سياق التنفيذ؟

سياق التنفيذ هو البيئة التي يُنفذ فيها كود JavaScript.
كل مرة يتم فيها تشغيل كود (سواء كان من المستوى الأعلى أو داخل دالة)، يتم إنشاء سياق تنفيذ خاص به.

📌 **هناك نوعان رئيسيان:**
* **السياق العام (Global Execution Context):** يتم إنشاؤه أولًا عند تحميل الصفحة.
* **سياقات الوظائف (Function Execution Contexts):** يتم إنشاؤها عند استدعاء كل دالة.

---

### 🧠 مثال عملي:

```javascript
let x = 10;

function multiply(y) {
  return x * y;
}

let result = multiply(3);
```
في هذا المثال:
1.  يتم إنشاء **السياق العام** ويخزن فيه `x` والدالة `multiply`.
2.  عند استدعاء `multiply(3)`، يتم إنشاء **سياق تنفيذ جديد** داخل المكدس.
3.  بعد إنهاء تنفيذ الدالة، يتم **إزالة** السياق من المكدس (pop).

---

### 🛠️ 2. ما هو المكدس (Call Stack)؟

المكدس هو بنية بيانات تُستخدم لتتبع سياقات التنفيذ.

* عندما يتم **استدعاء دالة** ⬅️ تُضاف إلى المكدس (Push).
* عند **إنهاء الدالة** ⬅️ تُزال من المكدس (Pop).

💥 إذا استمرت الدوال تستدعي بعضها دون توقف، ستحصل على الخطأ التالي:
`Maximum call stack size exceeded`

---

### 🧪 جرب بنفسك

```javascript
function greet(name) {
  return `Hello, ${name}!`;
}

function welcome() {
  let message = greet("Sara");
  console.log(message);
}

welcome();
```
🔍 **خطوات التنفيذ:**
1.  **السياق العام** ⬅️ يتم تحميل `greet` و `welcome`.
2.  `welcome()` ⬅️ يُضاف إلى المكدس.
3.  `greet("Sara")` ⬅️ يُضاف إلى المكدس.
4.  `greet` تُنهي عملها ⬅️ يتم إخراجها.
5.  `welcome` تُنهي عملها ⬅️ يتم إخراجها.

---

### 🔍 3. ما هو Hoisting؟

**Hoisting** هو سلوك في JavaScript يجعل تعريف المتغيرات والدوال "يُرفع" تلقائيًا إلى أعلى السياق قبل التنفيذ.

```javascript
console.log(x); // undefined
var x = 5;
```

❗ **مهم:** `let` و `const` لا تُهيأ تلقائيًا، وتؤدي إلى خطأ إذا تم الوصول إليها قبل التعريف.

---

### 👁️‍🗨️ مثال من الواقع

أثناء تحميل صفحة الويب، يتم إنشاء **السياق العام** ثم يتم تنفيذ الشيفرة خطوة بخطوة. أي استدعاء دوال يتم تتبعه تلقائيًا في **Call Stack**، وإذا حصلت أخطاء، يستطيع المتصفح تحديد موقعها بناءً على هذا التتبع.

---

### 🔍 حقيقة ممتعة

تُستخدم المكدسات أيضًا في لغات برمجة أخرى مثل C++ وPython، ولكن JavaScript تجعل من السهل مراقبتها عبر أدوات التطوير في المتصفح.

---

### 🚀 ماذا بعد؟

في الدرس التالي، سنتعرف على **سلسلة النطاقات (Scope Chain)** و**البيئة المعجمية (Lexical Environment)** وكيف تبحث JavaScript عن المتغيرات.

---