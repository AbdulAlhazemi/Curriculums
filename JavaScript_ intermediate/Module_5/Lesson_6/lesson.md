# الوحدة 5: وقت تشغيل جافاسكريبت والعمليات الداخلية
**(JavaScript Runtime & Internals)**

## الدرس 6: الحلقة الحدثية (Event Loop) والمكدس وقائمة الانتظار
**(Call Stack, Task Queue & Event Loop)**

🧠 **ماذا ستتعلم**
* ما هو المكدس (Call Stack) وما هي قائمة الانتظار (Task Queue)
* كيف تعمل الحلقة الحدثية (Event Loop)
* الفرق بين العمليات المتزامنة (Synchronous) وغير المتزامنة (Asynchronous)
* متى يتم تنفيذ `setTimeout` و`Promise`
* كيف تدير JavaScript الأحداث والمهام

---

### 🧾 1. ما هو المكدس (Call Stack)؟

المكدس هو المكان الذي توضع فيه سياقات التنفيذ أثناء تشغيل الكود.

* كل دالة تُنفذ ⬅️ تُضاف إلى المكدس (Push)
* عند انتهاء التنفيذ ⬅️ تُزال من المكدس (Pop)

إذا امتلأ المكدس بسبب استدعاءات متكررة ⬅️ يحدث خطأ: `Maximum call stack size exceeded`

---

### 🕒 2. ما الفرق بين المتزامن (Synchronous) وغير المتزامن (Asynchronous)؟

* **متزامن:** ينفذ الكود سطرًا بسطر، وينتظر كل سطر ينتهي.
* **غير متزامن:** لا ينتظر — يمكن تنفيذ مهام أخرى أثناء الانتظار.

**أمثلة:**
```javascript
console.log("1");
setTimeout(() => console.log("2"), 0);
console.log("3");
```
🔎 **الناتج:**
```
1
3
2
```
لأن `setTimeout` يتم وضعه في **قائمة الانتظار** وينتظر أن يكون المكدس فارغًا!

---

### 📦 3. ما هي قائمة الانتظار (Task Queue)؟

قائمة المهام (Task Queue) تخزن **الدوال غير المتزامنة** مثل `setTimeout`, `fetch`, `DOM events`…

المهام في هذه القائمة تنتظر حتى يصبح المكدس فارغًا ثم يتم تمريرها.

---

### 🔁 4. ما هي الحلقة الحدثية (Event Loop)؟

الحلقة الحدثية هي “المُنسق” بين **المكدس** و**قائمة الانتظار**.

دورها:
1.  تراقب المكدس.
2.  إذا كان فارغًا ⬅️ تسحب مهمة من قائمة الانتظار وتضعها في المكدس.

بهذا الشكل تضمن JavaScript تنفيذ الكود بسلاسة دون تجميد الصفحة.

---

### 🧪 5. جرب بنفسك
```javascript
console.log("Start");

setTimeout(() => {
  console.log("Inside Timeout");
}, 0);

Promise.resolve().then(() => {
  console.log("Inside Promise");
});

console.log("End");
```
🔎 **الناتج:**
```
Start
End
Inside Promise
Inside Timeout
```
📌 **ملاحظة:** `Promise` يتم تنفيذه في **Microtask Queue**، والتي لها أولوية أعلى من **Task Queue** (التي تحتوي على `setTimeout`).

---

### 👁️‍🗨️ مثال من الواقع

عند الضغط على زر في موقع إلكتروني، يتم إرسال الحدث إلى قائمة الانتظار، وتنتظر JavaScript حتى تُكمل ما تقوم به حاليًا، ثم تنفذ رد الفعل (callback) الخاص بالنقرة.

---

### 🔍 حقيقة ممتعة

الـ Event Loop هو السبب وراء قدرة JavaScript على التعامل مع آلاف المستخدمين في نفس الوقت على الخادم (Node.js)، دون الحاجة إلى “انتظار” كل طلب!

---

### 🏁 تهانينا!

أكملت الآن الوحدة الخاصة بـ **وقت تشغيل JavaScript والعمليات الداخلية**. لديك الآن فهم أعمق لما يحدث “تحت الغطاء” عندما تكتب وتنفذ شيفرة JavaScript!

---