# الوحدة 5: وقت تشغيل جافاسكريبت والعمليات الداخلية
**(JavaScript Runtime & Internals)**

## الدرس 4: سلسلة النطاقات والبيئة المعجمية
**(Scope Chain & Lexical Environment)**

🧠 **ماذا ستتعلم**
* ما هو النطاق (Scope) في JavaScript
* الفرق بين النطاق المحلي والعالمي
* كيف تعمل سلسلة النطاقات (Scope Chain)
* ما هي البيئة المعجمية (Lexical Environment)
* مفهوم "Shadowing" (التظليل)

---

### 🧾 1. ما هو النطاق؟

**النطاق (Scope)** هو المكان الذي يمكن فيه الوصول إلى المتغيرات والدوال.
في JavaScript، هناك ثلاثة أنواع رئيسية من النطاقات:

* **نطاق عالمي (Global Scope):** متغير متاح في كل مكان في الكود.
* **نطاق دالة (Function Scope):** متغير متاح فقط داخل الدالة.
* **نطاق كتلة (Block Scope):** متغير متاح فقط داخل `{}` إذا تم تعريفه باستخدام `let` أو `const`.

---

### 🧠 مثال عملي:

```javascript
let x = 10; // نطاق عالمي

function show() {
  let y = 5; // نطاق دالة
  console.log(x); // ✅ يمكن الوصول إلى x لأنها في النطاق الأعلى
  console.log(y); // ✅ يمكن الوصول إلى y لأنها محلية
}

show();
// console.log(y); // ❌ خطأ: y ليست في النطاق العام
```

---

### 🔗 2. ما هي سلسلة النطاقات؟

عندما تحتاج JavaScript إلى الوصول إلى متغير، فإنها تبحث في:
1.  النطاق الحالي.
2.  إذا لم تجده ⬅️ تبحث في النطاق الأعلى (الوالد).
3.  يستمر البحث حتى تصل إلى النطاق العام.

هذا ما يسمى بـ **سلسلة النطاقات (Scope Chain)**.

#### مثال عملي على سلسلة النطاقات:

```javascript
let a = 1; // نطاق عالمي

function outer() {
  let b = 2; // نطاق الدالة outer

  function inner() {
    let c = 3; // نطاق الدالة inner
    console.log(a, b, c); // ✅ تصل إلى جميع المتغيرات في السلسلة
  }

  inner();
}
outer(); // يطبع: 1 2 3
```
---

### 📚 3. ما هي البيئة المعجمية (Lexical Environment)?

**البيئة المعجمية** هي الطريقة التي تُحدد بها JavaScript **مكان المتغيرات والدوال** حسب **مكان كتابتها في الكود**، وليس عند تنفيذها.

💡 هذا يعني أن النطاق يتم تحديده في وقت الكتابة، **وليس وقت التشغيل**.

---

### ⚠️ 4. مفهوم “Shadowing” (تظليل المتغيرات)

عند تعريف متغير جديد بنفس اسم متغير في نطاق أعلى، يتم **تظليله** مؤقتًا:

```javascript
let name = "Sara";

function greet() {
  let name = "Layla"; // يظلل المتغير الخارجي
  console.log(name); // يطبع: Layla
}

greet();
console.log(name); // يطبع: Sara
```

---

### 👁️‍🗨️ مثال من الواقع

في تطبيق حقيقي، قد تكتب دالة داخل أخرى. إذا كنت تستخدم متغيرًا داخليًا بنفس اسم متغير عام، فإن JavaScript ستستخدم **المتغير الأقرب** في السلسلة — هذه ميزة قوية لكنها قد تسبب أخطاء إذا لم تكن حذرًا.

---

### 🔍 حقيقة ممتعة

كل دالة تُنشئ بيئتها الخاصة عند تعريفها، وليس فقط عند تنفيذها — وهذا ما يجعل **الإغلاقات (Closures)** ممكنة، وسنتعرف عليها في درس لاحق.

---

### 🚀 ماذا بعد؟

في الدرس التالي، سنتعمق في **محركات JavaScript** مثل V8 وSpiderMonkey ونتعرف على كيفية تنفيذ وتحسين الشيفرة فعليًا.

---